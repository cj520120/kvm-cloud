<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>系统分类</title>
    <link href="../layui/css/layui.css" rel="stylesheet">
    <link href="../css/style.css" rel="stylesheet">
    <link href="../image/kl_logo.png" rel="icon" type="image/png">
</head>
<body>
<div class="layui-form">
    <div class="layui-input-inline">
        <button class="layui-btn layui-btn-sm" lay-filter="formSearch"
                onclick="create_os_category_click()"><i class="layui-icon layui-icon-addition"></i>创建分类
        </button>
    </div>
</div>
<div id="content">

</div>
</body>

<script id="createDialog" type="text/html">
    <form class="layui-form" name="modify" action="" style="padding: 20px;padding-bottom: 5px;"
          lay-filter="editDialogForm">
        <div class="layui-form-item" style="margin-bottom:5px">
            <label class="layui-form-label" style="padding-left: 0px;padding-right: 5px;">分类名称</label>
            <div class="layui-input-inline">
                <input type="text" name="categoryName" placeholder="请输入分类名称" autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-form-item" style="margin-bottom:5px">
            <label class="layui-form-label" style="padding-left: 0px;padding-right: 5px;">网卡驱动</label>

            <div class="layui-input-inline" style="width:150px">
                <select name="networkDriver">
                    <option value="virtio">virtio</option>
                    <option value="e1000">e1000</option>
                    <option value="rtl8139">rtl8139</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item" style="margin-bottom:0px">
            <label class="layui-form-label" style="padding-left: 0px;padding-right: 5px;">磁盘驱动</label>
            <div class="layui-input-inline" style="width:150px">
                <select name="diskDriver">
                    <option value="virtio">virtio</option>
                    <option value="ide">ide</option>
                    <option value="sata">sata</option>
                </select>
            </div>
        </div>
    </form>
</script>
<script id="editDialog" type="text/html">
    <form class="layui-form" name="modify" action="" style="padding: 20px;padding-bottom: 5px;"
          lay-filter="editDialogForm">
        <input type="hidden" name="id"/>
        <div class="layui-form-item" style="margin-bottom:5px">
            <label class="layui-form-label" style="padding-left: 0px;padding-right: 5px;">分类名称</label>
            <div class="layui-input-inline">
                <input type="text" name="categoryName" autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-form-item" style="margin-bottom:5px">
            <label class="layui-form-label" style="padding-left: 0px;padding-right: 5px;">网卡驱动</label>

            <div class="layui-input-inline" style="width:150px">
                <select name="networkDriver">
                    <option value="virtio">virtio</option>
                    <option value="e1000">e1000</option>
                    <option value="rtl8139">rtl8139</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item" style="margin-bottom:0px">
            <label class="layui-form-label" style="padding-left: 0px;padding-right: 5px;">磁盘驱动</label>

            <div class="layui-input-inline" style="width:150px">
                <select name="diskDriver">
                    <option value="virtio">virtio</option>
                    <option value="ide">ide</option>
                    <option value="sata">sata</option>
                </select>
            </div>
        </div>
    </form>
</script>
<script src="../js/jquery.min.js"></script>
<script src="../js/config_util.js"></script>
<script src="../layui/layui.js"></script>
<script src="../js/util.js"></script>
<script src="../js/table_util.js"></script>
<script src="../js/data_handler.js"></script>
<script src="../js/data_util.js"></script>
<script src="../js/dialog_util.js"></script>
<script>

    config_util.init(()=> {
        window.data_handler = new data_handler({uri: config_util.base_uri + "/management/os/category", idName: "id"});
        window.category_table_util = new table_util();
        category_table_util.render({
            elem: "#content",
            idName: "id",
            cols: [
                {width: 80, title: "ID", name: "id"},
                {width: 180, title: "名称", name: "categoryName"},
                {width: 180, title: "磁盘驱动", name: "diskDriver"},
                {width: 180, title: "网络驱动", name: "networkDriver"},

                {
                    width: 180, title: "创建时间", render: function (data) {
                        return dateFormat("YYYY-mm-dd HH:MM:SS", new Date(data.createTime))
                    }
                }
            ],
            menu: [
                {
                    title: "编辑分类", icon: "layui-icon-set", show: function (data) {
                        return true
                    }, click: modify_os_category_click
                },
                {
                    title: "销毁分类", icon: "layui-icon-delete", show: function (data) {
                        return true
                    }, click: delete_os_category_click
                },
            ],
            handler: window.data_handler
        })
    })

    function create_os_category_click() {
        dialog_util.show_modify("#createDialog", "创建分类", "layui-icon-addition", "POST", config_util.base_uri+"/management/os/category/create", undefined, function (response) {
            if (response.code === 0) {
                category_table_util.append(response.data);
            } else {
                dialog_util.show_tool_tip('添加分类失败，错误码:' + response.code + '。错误信息:' + response.message);
            }
        })
    }

    function modify_os_category_click(data) {
        dialog_util.show_modify("#editDialog", "修改分类", "layui-icon-set", "POST", config_util.base_uri+"/management/os/category/modify", function () {
            $("form[name='modify']").serializeArray().filter(item => data[item.name]).map((item, index) => {
                $(`form[name='modify'] [name='${item.name}']`).val(data[item.name])
            })
        }, function (response) {
            if (response.code === 0) {
                category_table_util.modify(response.data);
            } else {
                dialog_util.show_tool_tip('修改分类失败，错误码:' + response.code + '。错误信息:' + response.message);
            }
        })
    }

    function delete_os_category_click(data) {
        dialog_util.show_confirm_dialog('确认删除分类', 'POST', config_util.base_uri+"/management/os/category/destroy", {id: data.id}, function (response) {
            if (response.code === 0) {
                category_table_util.remove(data);
            } else if (response.code) {
                dialog_util.show_tool_tip('删除分类失败，错误码:' + response.code + '。错误信息:' + response.message);
            }
        })
    }




</script>