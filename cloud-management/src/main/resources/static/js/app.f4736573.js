(()=>{var e={67986:e=>{e.exports={BASEURL:"."}},97080:(e,t,s)=>{"use strict";s(66992),s(88674),s(19601),s(17727);var o=s(27195),a=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[e.isFullScreen?e._e():t("HeadViewVue"),t("el-container",[e.isFullScreen?e._e():t("NavViewVue"),t("el-main",{staticClass:"main-container",class:e.isFullScreen?"full_screen_class":""},[t("router-view")],1)],1)],1)},r=[],n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"layout-left",attrs:{id:"LayoutLeft"}},[t("div",{staticClass:"shrink",on:{click:e.shrinkMenu}},[t("i",{class:e.isCollapse?"el-icon-s-unfold":"el-icon-s-fold"})]),t("el-menu",{staticClass:"el-menu-vertical-demo",attrs:{collapse:e.isCollapse,"default-active":this.$route.path,router:"","collapse-transition":!1,"background-color":"rgb(52, 73, 94)","text-color":"#fff","active-text-color":"#ffd04b"}},e._l(e.nav_menu_data,(function(s,o){return t("el-menu-item",{key:o,attrs:{index:s.path}},[t("i",{class:s.icon}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(s.title))])])})),1)],1)},l=[];const i={data:function(){return{path:"",isCollapse:!0,nav_menu_data:[{path:"/",title:"主页",icon:"el-icon-house"},{path:"/Guest",title:"虚拟机管理",icon:"el-icon-s-platform"},{path:"/Volume",title:"磁盘管理",icon:"el-icon-bank-card"},{path:"/Snapshot",title:"快照管理",icon:"el-icon-copy-document"},{path:"/Network",title:"网络管理",icon:"el-icon-platform-eleme"},{path:"/Host",title:"主机管理",icon:"el-icon-monitor"},{path:"/Storage",title:"存储池管理",icon:"el-icon-coin"},{path:"/Template",title:"模版管理",icon:"el-icon-price-tag"},{path:"/Scheme",title:"计算方案",icon:"el-icon-cpu"},{path:"/User",title:"用户管理",icon:"el-icon-s-custom"}]}},created:function(){this.isCollapse="0"!==localStorage.getItem("menu_is_collapse")},methods:{shrinkMenu:function(){this.isCollapse=!this.isCollapse,localStorage.setItem("menu_is_collapse",this.isCollapse?"1":"0")}}},c=i;var u=s(1001),d=(0,u.Z)(c,n,l,!1,null,"56b8a9fa",null);const _=d.exports;var p=function(){var e=this,t=e._self._c;return t("el-header",[t("div",{staticStyle:{float:"left","background-color":"#34495e",height:"100%"}},[t("img",{staticStyle:{width:"32px",height:"32px","margin-left":"10px","margin-top":"15px"},attrs:{src:s(66949)}})]),t("div",{staticStyle:{float:"left","background-color":"#34495e",height:"100%"}},[t("h5",{staticStyle:{"font-size":"18px",margin:"20px 0px 20px 10px",color:"white"}},[e._v("KVM Cloud")])]),t("el-menu",{staticClass:"headerMenu",attrs:{mode:"horizontal","background-color":"#34495e","text-color":"#fff","active-text-color":"#ffd04b"},on:{select:e.handleSelect}},[t("el-menu-item",{attrs:{index:"quit"}},[e._v("退出")]),t("el-menu-item",{attrs:{index:"password"}},[e._v("修改密码")])],1),t("el-dialog",{attrs:{title:"修改密码",visible:e.update_password_dialog_visible,center:"",width:"400px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.update_password_dialog_visible=t}}},[t("el-form",{attrs:{model:e.update_password,"label-position":"right","label-width":"80px"}},[t("el-form-item",{attrs:{label:"旧密码",prop:"oldPassword"}},[t("el-input",{attrs:{type:"password","show-password":!0},model:{value:e.update_password.oldPassword,callback:function(t){e.$set(e.update_password,"oldPassword",t)},expression:"update_password.oldPassword"}})],1),t("el-form-item",{attrs:{label:"新密码",prop:"newPassword"}},[t("el-input",{attrs:{type:"password","show-password":!0},model:{value:e.update_password.newPassword,callback:function(t){e.$set(e.update_password,"newPassword",t)},expression:"update_password.newPassword"}})],1),t("el-form-item",{attrs:{label:"确认密码",prop:"confirmPassword"}},[t("el-input",{attrs:{type:"password","show-password":!0},model:{value:e.update_password.confirmPassword,callback:function(t){e.$set(e.update_password,"confirmPassword",t)},expression:"update_password.confirmPassword"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.update_user_password_click}},[e._v("确 定")]),t("el-button",{on:{click:function(t){e.update_password_dialog_visible=!1}}},[e._v("取 消")])],1)],1)],1)],1)},h=[],m=(s(57658),s(45226)),f=s(27594),g=(s(41539),s(19265)),w=s(93069),v=s.n(w),y=s(42241),b=(s(68309),function(){var e=this,t=e._self._c;return t("div",[t("el-container",[t("el-main",[t("el-card",{directives:[{name:"show",rawName:"v-show",value:0===this.show_type,expression:"this.show_type === 0"}],staticClass:"box-card"},[t("el-row",{staticClass:"clearfix",staticStyle:{height:"20px"},attrs:{slot:"header"},slot:"header"},[t("el-button",{staticStyle:{float:"left",padding:"3px 0"},attrs:{type:"text"},on:{click:e.show_create_network}},[e._v("创建网络")])],1),t("el-row",[t("el-table",{staticStyle:{width:"100%"},attrs:{"v-loading":e.data_loading,data:e.networks}},[t("el-table-column",{attrs:{label:"ID",prop:"networkId",width:"80"}}),t("el-table-column",{attrs:{label:"名称",prop:"name",width:"120"}}),t("el-table-column",{attrs:{label:"桥接网卡",prop:"bridge",width:"120"}}),t("el-table-column",{attrs:{label:"网络类型",prop:"type",width:"100"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",[e._v(e._s(e.get_network_type(s.row)))])]}}])}),t("el-table-column",{attrs:{label:"状态",prop:"status",width:"100"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{attrs:{type:2===s.row.status?"success":"danger"}},[e._v(e._s(e.get_network_status(s.row)))])]}}])}),t("el-table-column",{attrs:{label:"操作","min-width":"380"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{type:"",size:"mini"},on:{click:function(t){return e.show_network_info_click(s.row)}}},[e._v("网络详情")]),t("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(t){return e.register_network(s.row)}}},[e._v("重新注册")]),3!==s.row.status?t("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){return e.pasue_network(s.row)}}},[e._v("开始维护")]):e._e(),t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.destroy_network(s.row)}}},[e._v("销毁网络")])]}}])})],1)],1)],1),t("el-card",{directives:[{name:"show",rawName:"v-show",value:1===this.show_type,expression:"this.show_type === 1"}],staticClass:"box-card"},[t("el-row",{attrs:{slot:"header"},slot:"header"},[t("el-page-header",{attrs:{content:"网络详情"},on:{back:e.show_network_list}})],1),t("el-row",{staticStyle:{"text-align":"left",margin:"20px 0"}},[t("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(t){return e.register_network(e.show_network)}}},[e._v("重新注册")]),3!==e.show_network.status?t("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){return e.pasue_network(e.show_network)}}},[e._v("开始维护")]):e._e(),t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.destroy_network(e.show_network)}}},[e._v("销毁网络")])],1),t("el-row",[t("el-descriptions",{attrs:{column:2,size:"medium",border:""}},[t("el-descriptions-item",{attrs:{label:"ID"}},[e._v(e._s(e.show_network.networkId))]),t("el-descriptions-item",{attrs:{label:"名称"}},[e._v(e._s(e.show_network.name))]),t("el-descriptions-item",{attrs:{label:"起始IP"}},[e._v(e._s(e.show_network.startIp))]),t("el-descriptions-item",{attrs:{label:"结束IP"}},[e._v(e._s(e.show_network.endIp))]),t("el-descriptions-item",{attrs:{label:"网关地址"}},[e._v(e._s(e.show_network.gateway))]),t("el-descriptions-item",{attrs:{label:"子网掩码"}},[e._v(e._s(e.show_network.mask))]),t("el-descriptions-item",{attrs:{label:"DNS"}},[e._v(e._s(e.show_network.dns))]),t("el-descriptions-item",{attrs:{label:"桥接网卡"}},[e._v(e._s(e.show_network.bridge))]),t("el-descriptions-item",{attrs:{label:"网络类型"}},[e._v(e._s(e.get_network_type(e.show_network)))]),1===e.show_network.type?t("el-descriptions-item",{attrs:{label:"VLAN ID"}},[e._v(e._s(e.show_network.vlanId))]):e._e(),1===e.show_network.type?t("el-descriptions-item",{attrs:{label:"基础网络"}},[t("el-link",{attrs:{type:"primary"}},[e._v(e._s(e.get_parent_network(e.show_network).name))])],1):e._e(),t("el-descriptions-item",{attrs:{label:"网络状态"}},[t("el-tag",{attrs:{type:2===e.show_network.status?"success":"danger"}},[e._v(e._s(e.get_network_status(e.show_network)))])],1)],1),t("br"),t("el-tabs",{attrs:{type:"border-card"}},[t("el-tab-pane",{attrs:{label:"系统组件"}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.system_guests}},[t("el-table-column",{attrs:{label:"ID",prop:"guestId",width:"80"}}),t("el-table-column",{attrs:{label:"实例名",prop:"name",width:"200"}}),t("el-table-column",{attrs:{label:"标签",prop:"description",width:"200"}}),t("el-table-column",{attrs:{label:"IP地址",prop:"guestIp",width:"150"}}),t("el-table-column",{attrs:{label:"状态",prop:"status",width:"100"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{attrs:{type:2===s.row.status?"success":"danger"}},[e._v(e._s(e.get_guest_status(s.row)))])]}}])}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-link",{attrs:{type:"primary",href:"/#/Guest?id=".concat(s.row.guestId)}},[e._v("详情")])]}}])})],1)],1)],1)],1)],1),t("el-card",{directives:[{name:"show",rawName:"v-show",value:2===this.show_type,expression:"this.show_type === 2"}],staticClass:"box-card"},[t("el-row",{attrs:{slot:"header"},slot:"header"},[t("el-page-header",{staticStyle:{color:"#409eff"},attrs:{content:"创建网络"},on:{back:function(t){return e.show_network_list()}}})],1),t("el-row",[t("el-form",{ref:"createForm",staticClass:"demo-ruleForm",attrs:{model:e.create_network,"label-width":"100px"}},[t("el-row",{attrs:{gutter:24}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"网络名称",prop:"name"}},[t("el-input",{model:{value:e.create_network.name,callback:function(t){e.$set(e.create_network,"name",t)},expression:"create_network.name"}})],1)],1)],1),t("el-row",{attrs:{gutter:24}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"起始IP",prop:"startIp"}},[t("el-input",{model:{value:e.create_network.startIp,callback:function(t){e.$set(e.create_network,"startIp",t)},expression:"create_network.startIp"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"结束IP",prop:"endIp"}},[t("el-input",{model:{value:e.create_network.endIp,callback:function(t){e.$set(e.create_network,"endIp",t)},expression:"create_network.endIp"}})],1)],1)],1),t("el-row",{attrs:{gutter:24}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"网关地址",prop:"gateway"}},[t("el-input",{model:{value:e.create_network.gateway,callback:function(t){e.$set(e.create_network,"gateway",t)},expression:"create_network.gateway"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"子网掩码",prop:"mask"}},[t("el-input",{model:{value:e.create_network.mask,callback:function(t){e.$set(e.create_network,"mask",t)},expression:"create_network.mask"}})],1)],1)],1),t("el-row",{attrs:{gutter:24}},[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"DNS",prop:"dns"}},[t("el-input",{model:{value:e.create_network.dns,callback:function(t){e.$set(e.create_network,"dns",t)},expression:"create_network.dns"}})],1)],1)],1),t("el-row",{attrs:{gutter:24}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"桥接网卡",prop:"bridge"}},[t("el-input",{model:{value:e.create_network.bridge,callback:function(t){e.$set(e.create_network,"bridge",t)},expression:"create_network.bridge"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"网络类型",prop:"type"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.create_network.type,callback:function(t){e.$set(e.create_network,"type",t)},expression:"create_network.type"}},[t("el-option",{attrs:{label:"基础网络",value:0}}),t("el-option",{attrs:{label:"Vlan网络",value:1}})],1)],1)],1)],1),1===e.create_network.type?t("el-row",{attrs:{gutter:24}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"VLAN ID",prop:"vlanId"}},[t("el-input",{model:{value:e.create_network.vlanId,callback:function(t){e.$set(e.create_network,"vlanId",t)},expression:"create_network.vlanId"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"基础网络",prop:"basicNetworkId"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择基础网络"},model:{value:e.create_network.basicNetworkId,callback:function(t){e.$set(e.create_network,"basicNetworkId",t)},expression:"create_network.basicNetworkId"}},e._l(e.networks,(function(e){return t("el-option",{directives:[{name:"show",rawName:"v-show",value:0===e.type,expression:"item.type === 0"}],key:e.networkId,attrs:{label:e.name,value:e.networkId}})})),1)],1)],1)],1):e._e(),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.create_network_click}},[e._v("立即创建")]),t("el-button",{on:{click:e.show_network_list}},[e._v("取消")])],1)],1)],1)],1)],1)],1)],1)}),k=[],I=s(51907),x=s(85617),T=(s(69826),s(34553),s(40561),s(54503)),S=(s(32564),function(){function e(){(0,m.Z)(this,e)}return(0,f.Z)(e,[{key:"init",value:function(t){if(!e.instance){var s="ws://".concat(window.location.host,"/api/ws/");e.instance=new WebSocket(s),e.instance.onopen=function(){},e.instance.onclose=function(){e.instance=void 0,setTimeout((function(){e.init(t)}),3e3)}}e.instance.onmessage=function(e){e.data&&t.handle_notify_message(JSON.parse(e.data))}}}]),e}());(0,T.Z)(S,"instance",void 0);const $=new S,C={data:function(){return{}},methods:{init_notify:function(){$.init(this)},handle_notify_message:function(e){console.log(e)}}},z={name:"NetworkView",components:{},data:function(){return{data_loading:!1,current_loading:!1,current_network_id:0,show_type:-1,show_network:{},system_guests:[],create_network:{name:"",startIp:"",endIp:"",gateway:"",mask:"",bridge:"",dns:"",type:0,vlanId:100,basicNetworkId:""},networks:[]}},mounted:function(){var e=this;this.current_network_id=this.$route.query.id,this.current_network_id?(this.show_type,this.current_loading=!0,Ye({networkId:this.current_network_id}).then((function(t){0===t.code?e.show_network_info_click(t.data):e.$alert("获取网络信息失败:".concat(t.message),"提示",{dangerouslyUseHTMLString:!0,confirmButtonText:"返回",type:"error"}).then((function(){e.show_type=0}))}))["finally"]((function(){e.current_loading=!1}))):this.show_type=0,this.init_view(),this.init_notify()},mixins:[C],methods:{init_view:function(){var e=this;return(0,x.Z)((0,I.Z)().mark((function t(){return(0,I.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.data_loading=!0,t.next=3,Qe().then((function(t){0==t.code&&(e.networks=t.data)}))["finally"]((function(){e.data_loading=!1}));case 3:case"end":return t.stop()}}),t)})))()},load_system_guest:function(e){var t=this;return(0,x.Z)((0,I.Z)().mark((function s(){return(0,I.Z)().wrap((function(s){while(1)switch(s.prev=s.next){case 0:return t.system_guests=[],s.next=3,At({networkId:e.networkId}).then((function(e){0===e.code&&(t.system_guests=e.data)}));case 3:case"end":return s.stop()}}),s)})))()},get_network_status:function(e){switch(e.status){case 1:return"正在注册";case 2:return"已就绪";case 3:return"正在维护";case 4:return"正在销毁";case 5:return"网络错误";default:return"未知状态[".concat(e.status,"]")}},get_network_type:function(e){switch(e.type){case 0:return"基础网络";case 1:return"Vlan网络";default:return"未知类型[".concat(e.type,"]")}},get_guest_status:function(e){switch(e.status){case 0:return"正在创建";case 1:return"正在启动";case 2:return"正在运行";case 3:return"正在停止";case 4:return"已停止";case 5:return"重启中";case 6:return"虚拟机错误";default:return"未知状态[".concat(e.status,"]")}},get_parent_network:function(e){var t=this.networks.find((function(t){return t.networkId===e.basicNetworkId}));return t||{name:"-"}},update_network_info:function(e){var t=this.networks.findIndex((function(t){return t.networkId===e.networkId}));t>=0?this.$set(this.networks,t,e):this.networks.push(e),this.show_network&&this.show_network.networId===e.networId&&(this.show_network=e)},handle_notify_message:function(e){var t=this;3===e.type?Ye({networkId:e.id}).then((function(s){if(0==s.code)t.update_network_info(s.data);else if(1000001==s.code){var o=t.networks.findIndex((function(t){return t.networkId===e.id}));o>=0&&t.networks.splice(o,1)}t.$forceUpdate()})):1===e.type&&Mt({guestId:e.id}).then((function(s){if(0==s.code){if(0===s.data.type&&s.data.networkId===t.show_network.networkId){var o=t.system_guests.findIndex((function(e){return e.guestId===s.data.guestId}));o>=0?t.$set(t.system_guests,o,s.data):t.system_guests.push(s.data)}t.$forceUpdate()}else if(2000001==s.code){var a=t.system_guests.findIndex((function(t){return t.guestId===e.id}));a>=0&&t.system_guests.splice(a,1)}}))},show_network_list:function(){this.show_type=0},show_create_network:function(){this.$refs["createForm"]&&this.$refs["createForm"].resetFields(),this.show_type=2},show_network_info_click:function(e){this.show_network=e,this.load_system_guest(e),this.show_type=1},create_network_click:function(){var e=this;0===this.create_network.type&&(this.create_network.vlanId=0,this.create_network.basicNetworkId=0),et(this.create_network).then((function(t){0===t.code?(e.update_network_info(t.data),e.show_type=0):e.$notify.error({title:"错误",message:"创建网络失败:".concat(t.message)})}))},pasue_network:function(e){var t=this;this.$confirm("维护网络, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){tt({networkId:e.networkId}).then((function(e){0===e.code?t.update_network_info(e.data):t.$notify.error({title:"错误",message:"暂停网络失败:".concat(e.message)})}))}))["catch"]((function(){}))},register_network:function(e){var t=this;this.$confirm("重新注册网络, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){st({networkId:e.networkId}).then((function(e){0===e.code?t.update_network_info(e.data):t.$notify.error({title:"错误",message:"注册网络失败:".concat(e.message)})}))}))["catch"]((function(){}))},destroy_network:function(e){var t=this;this.$confirm("销毁网络, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){ot({networkId:e.networkId}).then((function(e){0===e.code?(t.update_network_info(e.data),t.show_type=0):t.$notify.error({title:"错误",message:"删除网络失败:".concat(e.message)})}))}))["catch"]((function(){}))}}},q=z;var Z=(0,u.Z)(q,b,k,!1,null,"7a0f13f3",null);const B=Z.exports;var P=function(){var e=this,t=e._self._c;return t("div",[t("el-container",[t("el-main",[t("el-card",{directives:[{name:"show",rawName:"v-show",value:0===this.show_type,expression:"this.show_type === 0"}],staticClass:"box-card"},[t("el-row",{staticClass:"clearfix",staticStyle:{height:"20px"},attrs:{slot:"header"},slot:"header"},[t("el-button",{staticStyle:{float:"left",padding:"3px 0"},attrs:{type:"text"},on:{click:e.show_create_host}},[e._v("创建主机")])],1),t("el-row",[t("el-table",{staticStyle:{width:"100%"},attrs:{"v-loading":e.data_loading,data:e.hosts}},[t("el-table-column",{attrs:{label:"ID",prop:"hostId",width:"80"}}),t("el-table-column",{attrs:{label:"名称",prop:"displayName",width:"120"}}),t("el-table-column",{attrs:{label:"主机IP",prop:"hostIp",width:"120"}}),t("el-table-column",{attrs:{label:"CPU",prop:"hostIp",width:"180"},scopedSlots:e._u([{key:"default",fn:function(e){return[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"已使用:"+e.row.allocationCpu+"核 / 总共:"+e.row.totalCpu+"核",placement:"top"}},[t("el-progress",{attrs:{color:"#67C23A",percentage:Math.floor(100*e.row.allocationCpu/e.row.totalCpu)}})],1)]}}])}),t("el-table-column",{attrs:{label:"内存",prop:"hostIp",width:"180"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"已使用:"+e.get_memory_desplay(s.row.allocationMemory)+" / 总共:"+e.get_memory_desplay(s.row.totalMemory),placement:"top"}},[t("el-progress",{attrs:{color:"#67C23A",percentage:Math.floor(100*s.row.allocationMemory/s.row.totalMemory)}})],1)]}}])}),t("el-table-column",{attrs:{label:"状态",prop:"status",width:"100"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{attrs:{type:1===s.row.status?"success":"danger"}},[e._v(e._s(e.get_host_status(s.row)))])]}}])}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{type:"",size:"mini"},on:{click:function(t){return e.show_host_info_click(s.row)}}},[e._v("主机详情")]),t("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(t){return e.register_host(s.row)}}},[e._v("重新注册")]),3!==s.row.status?t("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){return e.pasue_host(s.row)}}},[e._v("开始维护")]):e._e(),t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.destroy_host(s.row)}}},[e._v("销毁主机")])]}}])})],1)],1)],1),1===this.show_type?t("el-card",{staticClass:"box-card"},[t("el-row",{attrs:{slot:"header"},slot:"header"},[t("el-page-header",{attrs:{content:"主机详情"},on:{back:e.show_host_list}})],1),t("el-row",{staticStyle:{"text-align":"left",margin:"20px 0"}},[t("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(t){return e.register_host(e.show_host)}}},[e._v("重新注册")]),3!==e.show_host.status?t("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){return e.pasue_host(e.show_host)}}},[e._v("开始维护")]):e._e(),t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.destroy_host(e.show_host)}}},[e._v("销毁主机")])],1),t("el-row",[t("el-descriptions",{attrs:{column:2,size:"medium",border:""}},[t("el-descriptions-item",{attrs:{label:"ID"}},[e._v(e._s(e.show_host.hostId))]),t("el-descriptions-item",{attrs:{label:"主机名"}},[e._v(e._s(e.show_host.hostName))]),t("el-descriptions-item",{attrs:{label:"显示名称"}},[e._v(e._s(e.show_host.displayName))]),t("el-descriptions-item",{attrs:{label:"主机IP"}},[e._v(e._s(e.show_host.hostIp))]),t("el-descriptions-item",{attrs:{label:"网卡名称"}},[e._v(e._s(e.show_host.nic))]),t("el-descriptions-item",{attrs:{label:"通信地址"}},[e._v(e._s(e.show_host.uri))]),t("el-descriptions-item",{attrs:{label:"主机架构"}},[e._v(e._s(e.show_host.arch))]),t("el-descriptions-item",{attrs:{label:"虚拟化类型"}},[e._v(e._s(e.show_host.hypervisor))]),t("el-descriptions-item",{attrs:{label:"内存"}},[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"已使用:"+e.get_memory_desplay(e.show_host.allocationMemory)+" / 总共:"+e.get_memory_desplay(e.show_host.totalMemory),placement:"top"}},[t("el-progress",{attrs:{color:"#67C23A",percentage:Math.floor(100*e.show_host.allocationMemory/e.show_host.totalMemory)}})],1)],1),t("el-descriptions-item",{attrs:{label:"CPU"}},[t("el-tooltip",{staticClass:"item",staticStyle:{width:"150px"},attrs:{effect:"dark",content:"已使用:"+e.show_host.allocationCpu+"核 / 总共:"+e.show_host.totalCpu+"核",placement:"top"}},[t("el-progress",{attrs:{color:"#67C23A",percentage:Math.floor(100*e.show_host.allocationCpu/e.show_host.totalCpu)}})],1)],1),t("el-descriptions-item",{attrs:{label:"Cores"}},[e._v(e._s(e.show_host.cores))]),t("el-descriptions-item",{attrs:{label:"Sockets"}},[e._v(e._s(e.show_host.sockets))]),t("el-descriptions-item",{attrs:{label:"Threads"}},[e._v(e._s(e.show_host.threads))]),t("el-descriptions-item",{attrs:{label:"Eemulator"}},[e._v(e._s(e.show_host.emulator))]),t("el-descriptions-item",{attrs:{label:"状态"}},[t("el-tag",{attrs:{type:1===e.show_host.status?"success":"danger"}},[e._v(e._s(e.get_host_status(e.show_host)))])],1)],1)],1)],1):e._e(),t("el-card",{directives:[{name:"show",rawName:"v-show",value:2===this.show_type,expression:"this.show_type === 2"}],staticClass:"box-card"},[t("el-row",{attrs:{slot:"header"},slot:"header"},[t("el-page-header",{staticStyle:{color:"#409eff"},attrs:{content:"创建主机"},on:{back:function(t){return e.show_host_list()}}})],1),t("el-row",[t("el-form",{ref:"createForm",staticClass:"demo-ruleForm",attrs:{model:e.create_host,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"显示名称",prop:"nadisplayNameme"}},[t("el-input",{model:{value:e.create_host.displayName,callback:function(t){e.$set(e.create_host,"displayName",t)},expression:"create_host.displayName"}})],1),t("el-form-item",{attrs:{label:"主机IP",prop:"hostIp"}},[t("el-input",{model:{value:e.create_host.hostIp,callback:function(t){e.$set(e.create_host,"hostIp",t)},expression:"create_host.hostIp"}})],1),t("el-form-item",{attrs:{label:"网卡名称",prop:"nic"}},[t("el-input",{model:{value:e.create_host.nic,callback:function(t){e.$set(e.create_host,"nic",t)},expression:"create_host.nic"}})],1),t("el-form-item",{attrs:{label:"通信地址",prop:"uri"}},[t("el-input",{model:{value:e.create_host.uri,callback:function(t){e.$set(e.create_host,"uri",t)},expression:"create_host.uri"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.create_host_click}},[e._v("立即创建")]),t("el-button",{on:{click:e.show_host_list}},[e._v("取消")])],1)],1)],1)],1)],1)],1)],1)},F=[];s(56977);const N={name:"hostView",components:{},data:function(){return{data_loading:!1,current_loading:!1,current_host_id:0,show_type:-1,show_host:{},create_host:{displayName:"",hostIp:"",nic:"",uri:""},hosts:[]}},mixins:[C],mounted:function(){var e=this;this.current_host_id=this.$route.query.id,this.current_host_id?(this.show_type,this.current_loading=!0,rt({hostId:this.current_host_id}).then((function(t){0===t.code?e.show_host_info_click(t.data):e.$alert("获取主机信息失败:".concat(t.message),"提示",{dangerouslyUseHTMLString:!0,confirmButtonText:"返回",type:"error"}).then((function(){e.show_type=0}))}))["finally"]((function(){e.current_loading=!1}))):this.show_type=0,this.init_view(),this.init_notify()},methods:{init_view:function(){var e=this;return(0,x.Z)((0,I.Z)().mark((function t(){return(0,I.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.data_loading=!0,t.next=3,at().then((function(t){0==t.code&&(e.hosts=t.data)}))["finally"]((function(){e.data_loading=!1}));case 3:case"end":return t.stop()}}),t)})))()},get_host_status:function(e){switch(e.status){case 0:return"正在创建";case 1:return"在线";case 2:return"离线";case 3:return"正在维护";case 4:return"主机错误";default:return"未知状态[".concat(e.status,"]")}},show_host_list:function(){this.show_type=0},show_create_host:function(){this.$refs["createForm"]&&this.$refs["createForm"].resetFields(),this.show_type=2},show_host_info_click:function(e){this.show_host=e,this.show_type=1},update_host_info:function(e){var t=this.hosts.findIndex((function(t){return t.hostId===e.hostId}));t>=0?this.$set(this.hosts,t,e):this.hosts.push(e),this.show_host&&this.show_host.hostId===e.hostId&&(this.show_host=e)},handle_notify_message:function(e){var t=this;4===e.type&&rt({hostId:e.id}).then((function(s){if(0==s.code)t.update_host_info(s.data);else if(7000001==s.code){var o=t.hosts.findIndex((function(t){return t.hostId===e.id}));o>=0&&t.hosts.splice(o,1)}}))},create_host_click:function(){var e=this;nt(this.create_host).then((function(t){0===t.code?(e.update_host_info(t.data),e.show_type=0):e.$notify.error({title:"错误",message:"创建主机失败:".concat(t.message)})}))},get_memory_desplay:function(e){return e>1048576?(e/1048576).toFixed(2)+" GB":e>1024?(e/1024).toFixed(2)+"  MB":void 0},pasue_host:function(e){var t=this;this.$confirm("维护主机, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){lt({hostId:e.hostId}).then((function(e){0===e.code?t.update_host_info(e.data):t.$notify.error({title:"错误",message:"暂停主机失败:".concat(e.message)})}))}))["catch"]((function(){}))},register_host:function(e){var t=this;this.$confirm("重新注册主机, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){it({hostId:e.hostId}).then((function(e){0===e.code?t.update_host_info(e.data):t.$notify.error({title:"错误",message:"注册主机失败:".concat(e.message)})}))}))["catch"]((function(){}))},destroy_host:function(e){var t=this;this.$confirm("删除当前主机, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){ct({hostId:e.hostId}).then((function(s){if(0===s.code){var o=t.hosts.findIndex((function(t){return t.hostId===e.hostId}));o>=0&&t.hosts.splice(o,1),t.show_type=0}else t.$notify.error({title:"错误",message:"删除主机失败:".concat(s.message)})}))}))["catch"]((function(){}))}}},V=N;var O=(0,u.Z)(V,P,F,!1,null,"cf1a4df6",null);const D=O.exports;s(91058);var E=function(){var e=this,t=e._self._c;return t("div",[t("el-container",[t("el-main",[t("el-card",{directives:[{name:"show",rawName:"v-show",value:0===this.show_type,expression:"this.show_type === 0"}],staticClass:"box-card"},[t("el-row",{staticClass:"clearfix",staticStyle:{height:"20px"},attrs:{slot:"header"},slot:"header"},[t("el-button",{staticStyle:{float:"left",padding:"3px 0"},attrs:{type:"text"},on:{click:e.show_create_storage}},[e._v("创建存储池")])],1),t("el-row",[t("el-table",{staticStyle:{width:"100%"},attrs:{"v-loading":e.data_loading,data:e.storages}},[t("el-table-column",{attrs:{label:"ID",prop:"storageId",width:"80"}}),t("el-table-column",{attrs:{label:"名称",prop:"name",width:"120"}}),t("el-table-column",{attrs:{label:"类型",prop:"type",width:"120"}}),t("el-table-column",{attrs:{label:"容量",prop:"capacity",width:"180"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"已用:"+e.get_storage_desplay(s.row.allocation)+" / 总共:"+e.get_storage_desplay(s.row.capacity),placement:"top"}},[t("el-progress",{attrs:{color:"#67C23A",percentage:parseInt(100*s.row.allocation/s.row.capacity)}})],1)]}}])}),t("el-table-column",{attrs:{label:"状态",prop:"status",width:"100"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{attrs:{type:1===s.row.status?"success":"danger"}},[e._v(e._s(e.get_storage_status(s.row)))])]}}])}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{type:"",size:"mini"},on:{click:function(t){return e.show_storage_info_click(s.row)}}},[e._v("存储池详情")]),t("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(t){return e.register_storage(s.row)}}},[e._v("重新注册")]),2!==s.row.status?t("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){return e.pasue_storage(s.row)}}},[e._v("开始维护")]):e._e(),t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.destroy_storage(s.row)}}},[e._v("销毁存储池")])]}}])})],1)],1)],1),t("el-card",{directives:[{name:"show",rawName:"v-show",value:1===this.show_type,expression:"this.show_type === 1"}],staticClass:"box-card"},[t("el-row",{attrs:{slot:"header"},slot:"header"},[t("el-page-header",{attrs:{content:"存储池详情"},on:{back:e.show_storage_list}})],1),t("el-row",{staticStyle:{"text-align":"left",margin:"20px 0"}},[t("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(t){return e.register_storage(e.show_storage)}}},[e._v("重新注册")]),3!==e.show_storage.status?t("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){return e.pasue_storage(e.show_storage)}}},[e._v("开始维护")]):e._e(),t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.destroy_storage(e.show_storage)}}},[e._v("销毁存储池")])],1),t("el-row",[t("el-descriptions",{attrs:{column:2,size:"medium",border:""}},[t("el-descriptions-item",{attrs:{label:"ID"}},[e._v(e._s(e.show_storage.storageId))]),t("el-descriptions-item",{attrs:{label:"存储池名"}},[e._v(e._s(e.show_storage.name))]),t("el-descriptions-item",{attrs:{label:"存储池类型"}},[e._v(e._s(e.show_storage.type))]),t("el-descriptions-item",{attrs:{label:"挂载路径"}},[e._v(e._s(e.show_storage.mountPath))]),"nfs"===e.show_storage.type?t("el-descriptions-item",{attrs:{label:"NFS路径"}},[e._v(e._s(JSON.parse(e.show_storage.param).path))]):e._e(),"nfs"===e.show_storage.type?t("el-descriptions-item",{attrs:{label:"NFS地址"}},[e._v(e._s(JSON.parse(e.show_storage.param).uri))]):e._e(),t("el-descriptions-item",{attrs:{label:"容量"}},[e._v(e._s(e.get_storage_desplay(e.show_storage.capacity)))]),t("el-descriptions-item",{attrs:{label:"可用"}},[e._v(e._s(e.get_storage_desplay(e.show_storage.available)))]),t("el-descriptions-item",{attrs:{label:"已申请"}},[e._v(e._s(e.get_storage_desplay(e.show_storage.allocation)))]),t("el-descriptions-item",{attrs:{label:"状态"}},[t("el-tag",{attrs:{type:1===e.show_storage.status?"success":"danger"}},[e._v(e._s(e.get_storage_status(e.show_storage)))])],1)],1)],1)],1),t("el-card",{directives:[{name:"show",rawName:"v-show",value:2===this.show_type,expression:"this.show_type === 2"}],staticClass:"box-card"},[t("el-row",{attrs:{slot:"header"},slot:"header"},[t("el-page-header",{staticStyle:{color:"#409eff"},attrs:{content:"创建存储池"},on:{back:function(t){return e.show_storage_list()}}})],1),t("el-row",[t("el-form",{ref:"createForm",staticClass:"demo-ruleForm",attrs:{model:e.create_storage,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"名称",prop:"name"}},[t("el-input",{model:{value:e.create_storage.name,callback:function(t){e.$set(e.create_storage,"name",t)},expression:"create_storage.name"}})],1),t("el-form-item",{attrs:{label:"存储池类型",prop:"type"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.create_storage.type,callback:function(t){e.$set(e.create_storage,"type",t)},expression:"create_storage.type"}},[t("el-option",{attrs:{label:"NFS",value:"nfs"}})],1)],1),"nfs"===e.create_storage.type?t("el-form-item",{attrs:{label:"NFS路径",prop:"path"}},[t("el-input",{model:{value:e.create_storage.path,callback:function(t){e.$set(e.create_storage,"path",t)},expression:"create_storage.path"}})],1):e._e(),"nfs"===e.create_storage.type?t("el-form-item",{attrs:{label:"NFS地址",prop:"uri"}},[t("el-input",{model:{value:e.create_storage.uri,callback:function(t){e.$set(e.create_storage,"uri",t)},expression:"create_storage.uri"}})],1):e._e(),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.create_storage_click}},[e._v("立即创建")]),t("el-button",{on:{click:e.show_storage_list}},[e._v("取消")])],1)],1)],1)],1)],1)],1)],1)},M=[];s(38862);const L={name:"storageView",components:{},data:function(){return{data_loading:!1,current_loading:!1,current_network_id:0,show_type:-1,show_storage:{},create_storage:{name:"",type:"nfs",param:"",path:"",uri:""},storages:[]}},mixins:[C],mounted:function(){var e=this;this.current_storage_id=this.$route.query.id,this.current_storage_id?(this.show_type,this.current_loading=!0,dt({storageId:this.current_storage_id}).then((function(t){0===t.code?e.show_storage_info_click(t.data):e.$alert("获取存储池信息失败:".concat(t.message),"提示",{dangerouslyUseHTMLString:!0,confirmButtonText:"返回",type:"error"}).then((function(){e.show_type=0}))}))["finally"]((function(){e.current_loading=!1}))):this.show_type=0,this.init_view(),this.init_notify()},methods:{init_view:function(){var e=this;return(0,x.Z)((0,I.Z)().mark((function t(){return(0,I.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.data_loading=!0,t.next=3,ut().then((function(t){0==t.code&&(e.storages=t.data)}))["finally"]((function(){e.data_loading=!1}));case 3:case"end":return t.stop()}}),t)})))()},get_storage_status:function(e){switch(e.status){case 0:return"正在创建";case 1:return"已就绪";case 2:return"正在维护";case 3:return"正在销毁";case 4:return"存储池错误";default:return"未知状态[".concat(e.status,"]")}},update_storate_info:function(e){var t=this.storages.findIndex((function(t){return t.storageId===e.storageId}));t>=0?this.$set(this.storages,t,e):this.storages.push(e),this.show_storage&&this.show_storage.storageId===e.storageId&&(this.show_storage=e)},handle_notify_message:function(e){var t=this;7===e.type&&dt({storageId:e.id}).then((function(s){if(0==s.code)t.update_storate_info(s.data);else if(3000001==s.code){var o=t.storages.findIndex((function(t){return t.storageId===e.id}));o>=0&&t.storages.splice(o,1)}}))},show_storage_list:function(){this.show_type=0},show_create_storage:function(){this.$refs["createForm"]&&this.$refs["createForm"].resetFields(),this.show_type=2},show_storage_info_click:function(e){this.show_storage=e,this.show_type=1},create_storage_click:function(){var e=this,t={name:this.create_storage.name,type:this.create_storage.type,param:"{}"};"nfs"===this.create_storage.type?(t.param=JSON.stringify({path:this.create_storage.path,uri:this.create_storage.uri}),_t(t).then((function(t){0===t.code?(e.update_storate_info(t.data),e.show_type=0):e.$notify.error({title:"错误",message:"创建存储池失败:".concat(t.message)})}))):this.$notify.error({title:"错误",message:"不支持的存储池:".concat(this.create_storage.type)})},get_storage_desplay:function(e){return e>1099511627776?(e/1099511627776).toFixed(2)+" TB":e>1073741824?(e/1073741824).toFixed(2)+" GB":e>1048576?(e/1048576).toFixed(2)+" MB":e>1024?(e/1024).toFixed(2)+"  KB":e+"  bytes"},pasue_storage:function(e){var t=this;this.$confirm("暂停存储池, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){pt({storageId:e.storageId}).then((function(e){0===e.code?t.update_storate_info(e.data):t.$notify.error({title:"错误",message:"暂停存储池失败:".concat(e.message)})}))}))["catch"]((function(){}))},register_storage:function(e){var t=this;this.$confirm("重新注册存储池, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){ht({storageId:e.storageId}).then((function(s){0===s.code?e.status=0:t.$notify.error({title:"错误",message:"注册存储池失败:".concat(s.message)})}))}))["catch"]((function(){}))},destroy_storage:function(e){var t=this;this.$confirm("删除存储池, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){mt({storageId:e.storageId}).then((function(e){0===e.code?(t.update_storate_info(e.data),t.show_type=0):t.$notify.error({title:"错误",message:"删除存储池失败:".concat(e.message)})}))}))["catch"]((function(){}))}}},U=L;var G=(0,u.Z)(U,E,M,!1,null,"36a8bd5d",null);const j=G.exports;s(82772);var A=function(){var e=this,t=e._self._c;return t("div",[t("el-container",[t("el-main",[t("el-card",{directives:[{name:"show",rawName:"v-show",value:0===this.show_type,expression:"this.show_type === 0"}],staticClass:"box-card"},[t("el-row",{staticClass:"clearfix",staticStyle:{height:"20px"},attrs:{slot:"header"},slot:"header"},[t("el-button",{staticStyle:{float:"left",padding:"3px 0"},attrs:{type:"text"},on:{click:e.show_create_template}},[e._v("创建模版")])],1),t("el-row",[t("el-table",{staticStyle:{width:"100%"},attrs:{"v-loading":e.data_loading,data:e.templates}},[t("el-table-column",{attrs:{label:"ID",prop:"templateId",width:"80"}}),t("el-table-column",{attrs:{label:"名称",prop:"name",width:"300"}}),t("el-table-column",{attrs:{label:"磁盘类型",prop:"volumeType",width:"120"}}),t("el-table-column",{attrs:{label:"类型",prop:"type",width:"100"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",[e._v(e._s(e.get_template_type(s.row)))])]}}])}),t("el-table-column",{attrs:{label:"状态",prop:"status",width:"100"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{attrs:{type:2===s.row.status?"success":"danger"}},[e._v(e._s(e.get_template_status(s.row)))])]}}])}),t("el-table-column",{attrs:{label:"操作","min-width":"380"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{type:"",size:"mini"},on:{click:function(t){return e.show_template_info(s.row)}}},[e._v("模版详情")]),0===s.row.templateType||1===s.row.templateType?t("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){return e.download_template(s.row)}}},[e._v("重新下载")]):e._e(),t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.destroy_template(s.row)}}},[e._v("销毁模版")])]}}])})],1)],1)],1),t("el-card",{directives:[{name:"show",rawName:"v-show",value:1===this.show_type,expression:"this.show_type === 1"}],staticClass:"box-card"},[t("el-row",{attrs:{slot:"header"},slot:"header"},[t("el-page-header",{attrs:{content:"模版详情"},on:{back:e.show_template_list}})],1),t("el-row",{staticStyle:{"text-align":"left",margin:"20px 0"}},[0===e.show_template.templateType||1===e.show_template.templateType?t("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){return e.download_template(e.show_template)}}},[e._v("重新下载")]):e._e(),t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.destroy_template(e.show_template)}}},[e._v("销毁模版")])],1),t("el-row",[t("el-descriptions",{attrs:{column:2,size:"medium",border:""}},[t("el-descriptions-item",{attrs:{label:"ID"}},[e._v(e._s(e.show_template.templateId))]),t("el-descriptions-item",{attrs:{label:"模版名"}},[e._v(e._s(e.show_template.name))]),e.show_template.uri&&0===e.show_template.uri.indexOf("http")?t("el-descriptions-item",{attrs:{label:"下载地址"}},[e._v(e._s(e.show_template.uri))]):e._e(),t("el-descriptions-item",{attrs:{label:"模版类型"}},[t("el-tag",[e._v(e._s(e.get_template_type(e.show_template)))])],1),t("el-descriptions-item",{attrs:{label:"状态"}},[t("el-tag",{attrs:{type:2===e.show_template.status?"success":"danger"}},[e._v(e._s(e.get_template_status(e.show_template)))])],1)],1)],1)],1),t("el-card",{directives:[{name:"show",rawName:"v-show",value:2===this.show_type,expression:"this.show_type === 2"}],staticClass:"box-card"},[t("el-row",{attrs:{slot:"header"},slot:"header"},[t("el-page-header",{staticStyle:{color:"#409eff"},attrs:{content:"创建模版"},on:{back:function(t){return e.show_template_list()}}})],1),t("el-row",[t("el-form",{ref:"createForm",staticClass:"demo-ruleForm",attrs:{model:e.create_template,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"名称",prop:"name"}},[t("el-input",{model:{value:e.create_template.name,callback:function(t){e.$set(e.create_template,"name",t)},expression:"create_template.name"}})],1),t("el-form-item",{attrs:{label:"模版类型",prop:"templateType"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.create_template.templateType,callback:function(t){e.$set(e.create_template,"templateType",t)},expression:"create_template.templateType"}},[t("el-option",{attrs:{label:"ISO",value:0}}),t("el-option",{attrs:{label:"系统模版",value:1}}),t("el-option",{attrs:{label:"用户模版",value:2}})],1)],1),2===e.create_template.templateType?t("el-form-item",{attrs:{label:"磁盘类型",prop:"volumeType"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.create_template.volumeType,callback:function(t){e.$set(e.create_template,"volumeType",t)},expression:"create_template.volumeType"}},[t("el-option",{attrs:{label:"raw",value:"raw"}}),t("el-option",{attrs:{label:"qcow",value:"qcow"}}),t("el-option",{attrs:{label:"qcow2",value:"qcow2"}}),t("el-option",{attrs:{label:"vdi",value:"vdi"}}),t("el-option",{attrs:{label:"vmdk",value:"vmdk"}}),t("el-option",{attrs:{label:"vpc",value:"vpc"}})],1)],1):e._e(),t("el-form-item",{attrs:{label:" 下载地址",prop:"uri"}},[t("el-input",{model:{value:e.create_template.uri,callback:function(t){e.$set(e.create_template,"uri",t)},expression:"create_template.uri"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.create_template_click}},[e._v("立即创建")]),t("el-button",{on:{click:e.show_template_list}},[e._v("取消")])],1)],1)],1)],1)],1)],1)],1)},H=[];const R={name:"templateView",components:{},data:function(){return{data_loading:!1,show_type:0,show_template:{},create_template:{name:"",templateType:0,volumeType:"qcow2",uri:""},templates:[]}},mixins:[C],created:function(){this.init_view(),this.init_notify()},methods:{init_view:function(){var e=this;return(0,x.Z)((0,I.Z)().mark((function t(){return(0,I.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.data_loading=!0,t.next=3,ft().then((function(t){0==t.code&&(e.templates=t.data)}))["finally"]((function(){e.data_loading=!1}));case 3:case"end":return t.stop()}}),t)})))()},get_template_status:function(e){switch(e.status){case 0:return"正在创建";case 1:return"下载中";case 2:return"已就绪";case 3:return"模版错误";default:return"未知状态[".concat(e.status,"]")}},get_template_type:function(e){switch(e.templateType){case 0:return"IOS 文件";case 1:return"系统模版";case 2:return"用户模版";default:return"未知模版[".concat(e.templateType,"]")}},show_template_list:function(){this.show_type=0},show_create_template:function(){this.$refs["createForm"]&&this.$refs["createForm"].resetFields(),this.show_type=2},show_template_info:function(e){this.show_template=e,this.show_type=1},update_template_info:function(e){var t=this.templates.findIndex((function(t){return t.templateId===e.templateId}));t>=0?this.$set(this.templates,t,e):this.templates.push(e),this.show_template&&this.show_template.templateId===e.templateId&&(this.show_template=e)},handle_notify_message:function(e){var t=this;5===e.type&&gt({templateId:e.id}).then((function(s){if(0==s.code)t.update_template_info(s.data);else if(5000001==s.code){var o=t.templates.findIndex((function(t){return t.templateId===e.id}));o>=0&&t.templates.splice(o,1)}}))},create_template_click:function(){var e=this,t={name:this.create_template.name,templateType:this.create_template.templateType,uri:this.create_template.uri,volumeType:this.create_template.templateType};0===this.create_template.templateType?t.volumeType="raw":1===this.create_template.templateType&&(t.volumeType="qcow2"),wt(t).then((function(t){0===t.code?(e.update_template_info(t.data),e.show_type=0):e.$notify.error({title:"错误",message:"创建模版失败:".concat(t.message)})}))},download_template:function(e){var t=this;this.$confirm("重新下载模版, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){yt({templateId:e.templateId}).then((function(e){0===e.code?t.update_template_info(e.data):t.$notify.error({title:"错误",message:"重新下载模版失败:".concat(e.message)})}))}))["catch"]((function(){}))},destroy_template:function(e){var t=this;this.$confirm("删除模版, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){bt({templateId:e.templateId}).then((function(s){if(0===s.code){var o=t.templates.findIndex((function(t){return t.templateId===e.templateId}));o>=0&&t.templates.splice(o,1),t.show_type=0}else t.$notify.error({title:"错误",message:"删除模版失败:".concat(s.message)})}))}))["catch"]((function(){}))}}},K=R;var X=(0,u.Z)(K,A,H,!1,null,"01a38e75",null);const J=X.exports;var W=function(){var e=this,t=e._self._c;return t("div",[t("el-container",[t("el-main",[t("el-card",{directives:[{name:"show",rawName:"v-show",value:0===this.show_type,expression:"this.show_type === 0"}],staticClass:"box-card"},[t("el-row",[t("el-table",{staticStyle:{width:"100%"},attrs:{"v-loading":e.data_loading,data:e.snapshots}},[t("el-table-column",{attrs:{label:"ID",prop:"snapshotVolumeId",width:"80"}}),t("el-table-column",{attrs:{label:"名称",prop:"name",width:"300"}}),t("el-table-column",{attrs:{label:"磁盘类型",prop:"type",width:"100"}}),t("el-table-column",{attrs:{label:"磁盘空间",prop:"capacity",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.get_volume_desplay_size(t.row.capacity))+" ")]}}])}),t("el-table-column",{attrs:{label:"物理空间",prop:"allocation",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.get_volume_desplay_size(t.row.allocation))+" ")]}}])}),t("el-table-column",{attrs:{label:"状态",prop:"status",width:"100"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{attrs:{type:1===s.row.status?"success":"danger"}},[e._v(e._s(e.get_snapshot_status(s.row)))])]}}])}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{type:"",size:"mini"},on:{click:function(t){return e.show_snapshot_info(s.row)}}},[e._v("快照详情")]),t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.destroy_snapshot(s.row)}}},[e._v("销毁快照")])]}}])})],1)],1)],1),t("el-card",{directives:[{name:"show",rawName:"v-show",value:1===this.show_type,expression:"this.show_type === 1"}],staticClass:"box-card"},[t("el-row",{attrs:{slot:"header"},slot:"header"},[t("el-page-header",{attrs:{content:"快照详情"},on:{back:e.show_snapshot_list}})],1),t("el-row",{staticStyle:{"text-align":"left",margin:"20px 0"}},[t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.destroy_snapshot(e.show_snapshot)}}},[e._v("销毁快照")])],1),t("el-row",[t("el-descriptions",{attrs:{column:2,size:"medium",border:""}},[t("el-descriptions-item",{attrs:{label:"ID"}},[e._v(e._s(e.show_snapshot.snapshotVolumeId))]),t("el-descriptions-item",{attrs:{label:"快照名"}},[e._v(e._s(e.show_snapshot.name))]),t("el-descriptions-item",{attrs:{label:"快照路径"}},[e._v(e._s(e.show_snapshot.volumePath))]),t("el-descriptions-item",{attrs:{label:"快照容量"}},[e._v(e._s(e.get_volume_desplay_size(e.show_snapshot.capacity)))]),t("el-descriptions-item",{attrs:{label:"物理占有"}},[e._v(e._s(e.get_volume_desplay_size(e.show_snapshot.allocation)))]),t("el-descriptions-item",{attrs:{label:"磁盘类型"}},[e._v(e._s(e.show_snapshot.type))]),t("el-descriptions-item",{attrs:{label:"存储池"}},[e._v(e._s(e.get_storage_name(e.show_snapshot.storageId)))]),t("el-descriptions-item",{attrs:{label:"状态"}},[t("el-tag",{attrs:{type:1===e.show_snapshot.status?"success":"danger"}},[e._v(e._s(e.get_snapshot_status(e.show_snapshot)))])],1)],1)],1)],1)],1)],1)],1)},Q=[];const Y={name:"snapshotView",components:{},data:function(){return{data_loading:!1,show_type:0,show_snapshot:{},snapshots:[],storages:[]}},mixins:[C],created:function(){this.init_view(),this.init_notify()},methods:{init_view:function(){var e=this;return(0,x.Z)((0,I.Z)().mark((function t(){return(0,I.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.data_loading=!0,t.next=3,ut().then((function(t){0===t.code&&(e.storages=t.data)}));case 3:return t.next=5,kt().then((function(t){0==t.code&&(e.snapshots=t.data)}))["finally"]((function(){e.data_loading=!1}));case 5:case"end":return t.stop()}}),t)})))()},get_storage_name:function(e){var t=this.storages.find((function(t){return t.storageId===e}))||{name:"-"};return t.name},get_volume_desplay_size:function(e){return e>1099511627776?(e/1099511627776).toFixed(2)+" TB":e>1073741824?(e/1073741824).toFixed(2)+" GB":e>1048576?(e/1048576).toFixed(2)+" MB":e>1024?(e/1024).toFixed(2)+"  KB":e+"  bytes"},get_snapshot_status:function(e){switch(e.status){case 0:return"正在创建";case 1:return"已就绪";case 2:return"快照错误";case 3:return"正在删除";default:return"未知状态[".concat(e.status,"]")}},show_snapshot_list:function(){this.show_type=0},show_snapshot_info:function(e){this.show_snapshot=e,this.show_type=1},update_snapshot_info:function(e){var t=this.snapshots.findIndex((function(t){return t.snapshotVolumeId===e.snapshotVolumeId}));t>=0?this.$set(this.snapshots,t,e):this.snapshots.push(e),this.show_snapshot&&this.show_snapshot.snapshotVolumeId===e.snapshotVolumeId&&(this.show_snapshot=e)},handle_notify_message:function(e){var t=this;6===e.type&&It({snapshotVolumeId:e.id}).then((function(s){if(0==s.code)t.update_snapshot_info(s.data);else if(6000001==s.code){var o=t.snapshots.findIndex((function(t){return t.snapshotVolumeId===e.id}));o>=0&&t.snapshots.splice(o,1)}}))},destroy_snapshot:function(e){var t=this;this.$confirm("删除快照, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Tt({snapshotVolumeId:e.snapshotVolumeId}).then((function(s){if(0===s.code){var o=t.snapshots.findIndex((function(t){return t.snapshotVolumeId===e.snapshotVolumeId}));o>=0&&t.snapshots.splice(o,1),t.show_type=0}else t.$notify.error({title:"错误",message:"删除快照失败:".concat(s.message)})}))}))["catch"]((function(){}))}}},ee=Y;var te=(0,u.Z)(ee,W,Q,!1,null,"1f36b953",null);const se=te.exports;s(82526),s(41817);var oe=function(){var e=this,t=e._self._c;return t("div",[t("el-container",[t("el-main",[t("el-card",{directives:[{name:"show",rawName:"v-show",value:0===this.show_type,expression:"this.show_type === 0"}],staticClass:"box-card"},[t("el-row",{staticClass:"clearfix",staticStyle:{height:"20px"},attrs:{slot:"header"},slot:"header"},[t("el-col",{attrs:{span:12}},[t("el-link",{attrs:{type:"primary"},on:{click:e.show_create_volume}},[e._v("创建磁盘")]),t("el-link",{staticStyle:{margin:"0 10px"},attrs:{type:"primary"},on:{click:e.show_upload_volume}},[e._v("导入磁盘")]),t("el-link",{attrs:{disabled:!e.select_volumes.length,type:"danger"},on:{click:e.batch_destroy_volume_click}},[e._v("批量删除")])],1),t("el-col",{attrs:{span:12}},[t("el-input",{staticStyle:{float:"right",width:"300px","margin-bottom":"10px"},attrs:{placeholder:"请输入搜索关键字"},on:{input:e.update_show_page},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}})],1)],1),t("el-row",[t("el-table",{staticStyle:{width:"100%"},attrs:{"v-loading":e.data_loading,data:e.show_table_volumes},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"55"}}),t("el-table-column",{attrs:{label:"ID",prop:"volumeId",width:"80"}}),t("el-table-column",{attrs:{label:"名称",prop:"description"}}),t("el-table-column",{attrs:{label:"磁盘类型",prop:"type",width:"100"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",[e._v(e._s(s.row.type))])]}}])}),t("el-table-column",{attrs:{label:"磁盘空间",prop:"capacity",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.get_volume_desplay_size(t.row.capacity))+" ")]}}])}),t("el-table-column",{attrs:{label:"物理空间",prop:"allocation",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.get_volume_desplay_size(t.row.allocation))+" ")]}}])}),t("el-table-column",{attrs:{label:"挂载主机",prop:"allocation",width:"200"},scopedSlots:e._u([{key:"default",fn:function(s){return[s.row.attach?t("el-link",{attrs:{type:"primary",href:"/#/Guest?id=".concat(s.row.attach.guestId),underline:!1}},[e._v(e._s(s.row.attach?s.row.attach.description:"-"))]):e._e(),s.row.attach?e._e():t("span",[e._v(e._s(s.row.attach?s.row.attach.description:"-"))])]}}])}),t("el-table-column",{attrs:{label:"状态",prop:"status",width:"100"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{attrs:{type:1===s.row.status?"success":"danger"}},[e._v(e._s(e.get_volume_status(s.row)))])]}}])}),t("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-dropdown",{attrs:{size:"small","split-button":"",placement:"bottom-end",type:"primary"},on:{click:function(t){return e.show_volume_info(s.row)},command:e.menu_command_click}},[e._v(" 磁盘管理 "),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:{volume:s.row,command:"info"}}},[e._v("磁盘详情")]),t("el-dropdown-item",{attrs:{command:{volume:s.row,command:"resize"},divided:""}},[e._v("扩容磁盘")]),t("el-dropdown-item",{attrs:{command:{volume:s.row,command:"clone"}}},[e._v("克隆磁盘")]),t("el-dropdown-item",{attrs:{command:{volume:s.row,command:"migrate"}}},[e._v("迁移磁盘")]),t("el-dropdown-item",{attrs:{command:{volume:s.row,command:"snapshote"},divided:""}},[e._v("创建快照")]),t("el-dropdown-item",{attrs:{command:{volume:s.row,command:"template"}}},[e._v("创建模版")]),t("el-dropdown-item",{attrs:{command:{volume:s.row,command:"destroy"},divided:""}},[e._v("销毁磁盘")])],1)],1)]}}])})],1),t("el-pagination",{attrs:{"current-page":e.current_page,"page-size":e.page_size,"page-sizes":[5,10,20,50,100,200],total:e.total_size,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.on_page_size_change,"current-change":e.on_current_page_change}})],1)],1),t("el-card",{directives:[{name:"show",rawName:"v-show",value:1===this.show_type,expression:"this.show_type === 1"}],staticClass:"box-card"},[t("el-row",{attrs:{slot:"header"},slot:"header"},[t("el-page-header",{attrs:{content:"磁盘详情"},on:{back:e.show_volume_list}})],1),t("el-row",{staticStyle:{"text-align":"left",margin:"20px 0"}},[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.show_create_volume()}}},[e._v("创建磁盘")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.show_resize_volume_click(e.show_volume)}}},[e._v("扩容磁盘")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.show_clone_volume_click(e.show_volume)}}},[e._v("克隆磁盘")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.show_migrate_volume_click(e.show_volume)}}},[e._v("迁移磁盘")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.show_create_volume_snapshot_click(e.show_volume)}}},[e._v("创建快照")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.show_create_volume_template_click(e.show_volume)}}},[e._v("创建模版")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.show_download_volume_click(e.show_volume)}}},[e._v("下载磁盘")]),t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.destroy_volume(e.show_volume)}}},[e._v("销毁磁盘")])],1),t("el-row",[t("el-descriptions",{attrs:{column:2,size:"medium",border:""}},[t("el-descriptions-item",{attrs:{label:"ID"}},[e._v(e._s(e.show_volume.volumeId))]),t("el-descriptions-item",{attrs:{label:"磁盘名"}},[e._v(e._s(e.show_volume.description))]),t("el-descriptions-item",{attrs:{label:"磁盘类型"}},[e._v(e._s(e.show_volume.type))]),t("el-descriptions-item",{attrs:{label:"磁盘路径"}},[e._v(e._s(e.show_volume.path))]),t("el-descriptions-item",{attrs:{label:"磁盘模版"}},[e._v(e._s(e.show_volume.template?e.show_volume.template.name:"-"))]),t("el-descriptions-item",{attrs:{label:"磁盘存储池"}},[t("el-link",{attrs:{type:"primary",href:"/#/Storage?id=".concat(e.show_volume.storageId),underline:!1}},[e._v(" "+e._s(e.get_storage_name(e.show_volume.storageId))+" ")])],1),t("el-descriptions-item",{attrs:{label:"挂载主机"}},[e.show_volume.attach?t("el-link",{attrs:{type:"primary",href:"/#/Guest?id=".concat(e.show_volume.attach.guestId),underline:!1}},[e._v(" "+e._s(e.show_volume.attach.description)+" ")]):e._e(),e.show_volume.attach?e._e():t("span",[e._v("-")])],1),t("el-descriptions-item",{attrs:{label:"磁盘容量"}},[e._v(e._s(e.get_volume_desplay_size(e.show_volume.capacity)))]),t("el-descriptions-item",{attrs:{label:"物理占用"}},[e._v(e._s(e.get_volume_desplay_size(e.show_volume.allocation)))]),t("el-descriptions-item",{attrs:{label:"状态"}},[t("el-tag",{attrs:{type:1===e.show_volume.status?"success":"danger"}},[e._v(e._s(e.get_volume_status(e.show_volume)))])],1)],1)],1)],1),t("el-card",{directives:[{name:"show",rawName:"v-show",value:2===this.show_type,expression:"this.show_type === 2"}],staticClass:"box-card"},[t("el-row",{attrs:{slot:"header"},slot:"header"},[t("el-page-header",{staticStyle:{color:"#409eff"},attrs:{content:"创建磁盘"},on:{back:function(t){return e.show_volume_list()}}})],1),t("el-row",[t("el-form",{ref:"createForm",staticClass:"demo-ruleForm",attrs:{model:e.create_volume,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"名称",prop:"description"}},[t("el-input",{model:{value:e.create_volume.description,callback:function(t){e.$set(e.create_volume,"description",t)},expression:"create_volume.description"}})],1),t("el-form-item",{attrs:{label:"存储池",prop:"type"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.create_volume.storageId,callback:function(t){e.$set(e.create_volume,"storageId",t)},expression:"create_volume.storageId"}},[t("el-option",{attrs:{label:"随机",value:0}}),e._l(this.storages,(function(e){return t("el-option",{key:e.storageId,attrs:{label:e.name,value:e.storageId}})}))],2)],1),t("el-form-item",{attrs:{label:"磁盘类型",prop:"volumeType"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.create_volume.volumeType,callback:function(t){e.$set(e.create_volume,"volumeType",t)},expression:"create_volume.volumeType"}},[t("el-option",{attrs:{label:"raw",value:"raw"}}),t("el-option",{attrs:{label:"qcow",value:"qcow"}}),t("el-option",{attrs:{label:"qcow2",value:"qcow2"}}),t("el-option",{attrs:{label:"vdi",value:"vdi"}}),t("el-option",{attrs:{label:"vmdk",value:"vmdk"}}),t("el-option",{attrs:{label:"vpc",value:"vpc"}})],1)],1),t("el-form-item",{attrs:{label:"磁盘大小(GB)",prop:"volumeSize"}},[t("el-input",{model:{value:e.create_volume.volumeSize,callback:function(t){e.$set(e.create_volume,"volumeSize",t)},expression:"create_volume.volumeSize"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.create_volume_click}},[e._v("立即创建")]),t("el-button",{on:{click:e.show_volume_list}},[e._v("取消")])],1)],1)],1)],1),t("el-card",{directives:[{name:"show",rawName:"v-show",value:3===this.show_type,expression:"this.show_type === 3"}],staticClass:"box-card"},[t("el-row",{attrs:{slot:"header"},slot:"header"},[t("el-page-header",{staticStyle:{color:"#409eff"},attrs:{content:"克隆磁盘"},on:{back:function(t){return e.show_volume_list()}}})],1),t("el-row",[t("el-form",{ref:"cloneForm",staticClass:"demo-ruleForm",attrs:{model:e.clone_volume,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"名称",prop:"description"}},[t("el-input",{model:{value:e.clone_volume.description,callback:function(t){e.$set(e.clone_volume,"description",t)},expression:"clone_volume.description"}})],1),t("el-form-item",{attrs:{label:"存储池",prop:"storageId"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.clone_volume.storageId,callback:function(t){e.$set(e.clone_volume,"storageId",t)},expression:"clone_volume.storageId"}},[t("el-option",{attrs:{label:"随机",value:0}}),e._l(this.storages,(function(e){return t("el-option",{key:e.storageId,attrs:{label:e.name,value:e.storageId}})}))],2)],1),t("el-form-item",{attrs:{label:"磁盘类型",prop:"volumeType"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.clone_volume.volumeType,callback:function(t){e.$set(e.clone_volume,"volumeType",t)},expression:"clone_volume.volumeType"}},[t("el-option",{attrs:{label:"raw",value:"raw"}}),t("el-option",{attrs:{label:"qcow",value:"qcow"}}),t("el-option",{attrs:{label:"qcow2",value:"qcow2"}}),t("el-option",{attrs:{label:"vdi",value:"vdi"}}),t("el-option",{attrs:{label:"vmdk",value:"vmdk"}}),t("el-option",{attrs:{label:"vpc",value:"vpc"}})],1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.clone_volume_click}},[e._v("克隆")]),t("el-button",{on:{click:e.show_volume_list}},[e._v("取消")])],1)],1)],1)],1),t("el-card",{directives:[{name:"show",rawName:"v-show",value:4===this.show_type,expression:"this.show_type === 4"}],staticClass:"box-card"},[t("el-row",{attrs:{slot:"header"},slot:"header"},[t("el-page-header",{staticStyle:{color:"#409eff"},attrs:{content:"迁移磁盘"},on:{back:function(t){return e.show_volume_list()}}})],1),t("el-row",[t("el-form",{staticClass:"demo-ruleForm",attrs:{model:e.migrate_volume,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"存储池",prop:"type"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.migrate_volume.storageId,callback:function(t){e.$set(e.migrate_volume,"storageId",t)},expression:"migrate_volume.storageId"}},[t("el-option",{attrs:{label:"随机",value:0}}),e._l(this.storages,(function(e){return t("el-option",{key:e.storageId,attrs:{label:e.name,value:e.storageId}})}))],2)],1),t("el-form-item",{attrs:{label:"磁盘类型",prop:"volumeType"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.migrate_volume.volumeType,callback:function(t){e.$set(e.migrate_volume,"volumeType",t)},expression:"migrate_volume.volumeType"}},[t("el-option",{attrs:{label:"raw",value:"raw"}}),t("el-option",{attrs:{label:"qcow",value:"qcow"}}),t("el-option",{attrs:{label:"qcow2",value:"qcow2"}}),t("el-option",{attrs:{label:"vdi",value:"vdi"}}),t("el-option",{attrs:{label:"vmdk",value:"vmdk"}}),t("el-option",{attrs:{label:"vpc",value:"vpc"}})],1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.migrate_volume_click}},[e._v("迁移")]),t("el-button",{on:{click:e.show_volume_list}},[e._v("取消")])],1)],1)],1)],1),t("el-dialog",{attrs:{title:"磁盘扩容",visible:e.resize_dialog_visiable,width:"300px"},on:{"update:visible":function(t){e.resize_dialog_visiable=t}}},[t("el-form",{attrs:{model:e.resize_volume,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"磁盘大小(GB)"}},[t("el-input",{attrs:{placeholder:"请输入磁盘大小(GB)"},model:{value:e.resize_volume.size,callback:function(t){e.$set(e.resize_volume,"size",t)},expression:"resize_volume.size"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.resize_dialog_visiable=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.resize_volume_click}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"创建模版",visible:e.template_dialog_visiable,width:"400px"},on:{"update:visible":function(t){e.template_dialog_visiable=t}}},[t("el-form",{attrs:{model:e.resize_volume,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"模版名称"}},[t("el-input",{attrs:{placeholder:"请输入模版名称"},model:{value:e.template_volume.name,callback:function(t){e.$set(e.template_volume,"name",t)},expression:"template_volume.name"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.template_dialog_visiable=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.create_volume_template_click}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"创建快照",visible:e.snapshot_dialog_visiable,width:"400px"},on:{"update:visible":function(t){e.snapshot_dialog_visiable=t}}},[t("el-form",{attrs:{model:e.snapshot_volume,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"快照名称"}},[t("el-input",{attrs:{placeholder:"请输入快照名称"},model:{value:e.snapshot_volume.snapshotName,callback:function(t){e.$set(e.snapshot_volume,"snapshotName",t)},expression:"snapshot_volume.snapshotName"}})],1),t("el-form-item",{attrs:{label:"磁盘类型",prop:"volumeType"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.snapshot_volume.snapshotVolumeType,callback:function(t){e.$set(e.snapshot_volume,"snapshotVolumeType",t)},expression:"snapshot_volume.snapshotVolumeType"}},[t("el-option",{attrs:{label:"raw",value:"raw"}}),t("el-option",{attrs:{label:"qcow",value:"qcow"}}),t("el-option",{attrs:{label:"qcow2",value:"qcow2"}}),t("el-option",{attrs:{label:"vdi",value:"vdi"}}),t("el-option",{attrs:{label:"vmdk",value:"vmdk"}}),t("el-option",{attrs:{label:"vpc",value:"vpc"}})],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.snapshot_dialog_visiable=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.create_volume_snapshot_click}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"下载磁盘",visible:e.download_dialog_visiable,width:"400px"},on:{"update:visible":function(t){e.download_dialog_visiable=t}}},[t("el-form",{attrs:{model:e.download_volume,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"磁盘类型",prop:"volumeType"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.download_volume.volumeType,callback:function(t){e.$set(e.download_volume,"volumeType",t)},expression:"download_volume.volumeType"}},[t("el-option",{attrs:{label:"raw",value:"raw"}}),t("el-option",{attrs:{label:"qcow",value:"qcow"}}),t("el-option",{attrs:{label:"qcow2",value:"qcow2"}}),t("el-option",{attrs:{label:"vdi",value:"vdi"}}),t("el-option",{attrs:{label:"vmdk",value:"vmdk"}}),t("el-option",{attrs:{label:"vpc",value:"vpc"}})],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.download_dialog_visiable=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.download_volume_click}},[e._v("下载")])],1)],1),t("el-card",{directives:[{name:"show",rawName:"v-show",value:5===this.show_type,expression:"this.show_type === 5"}],staticClass:"box-card"},[t("el-row",{attrs:{slot:"header"},slot:"header"},[t("el-page-header",{staticStyle:{color:"#409eff"},attrs:{content:"上传磁盘"},on:{back:function(t){return e.show_volume_list()}}})],1),t("el-row",[t("el-form",{ref:"uploadForm",staticClass:"demo-ruleForm",attrs:{model:e.upload_volume,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"名称",prop:"description"}},[t("el-input",{model:{value:e.upload_volume.description,callback:function(t){e.$set(e.upload_volume,"description",t)},expression:"upload_volume.description"}})],1),t("el-form-item",{attrs:{label:"存储池",prop:"storageId"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.upload_volume.storageId,callback:function(t){e.$set(e.upload_volume,"storageId",t)},expression:"upload_volume.storageId"}},[t("el-option",{attrs:{label:"随机",value:0}}),e._l(this.storages,(function(e){return t("el-option",{key:e.storageId,attrs:{label:e.name,value:e.storageId}})}))],2)],1),t("el-form-item",{attrs:{label:"目标磁盘类型",prop:"volumeType"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.upload_volume.volumeType,callback:function(t){e.$set(e.upload_volume,"volumeType",t)},expression:"upload_volume.volumeType"}},[t("el-option",{attrs:{label:"raw",value:"raw"}}),t("el-option",{attrs:{label:"qcow",value:"qcow"}}),t("el-option",{attrs:{label:"qcow2",value:"qcow2"}}),t("el-option",{attrs:{label:"vdi",value:"vdi"}}),t("el-option",{attrs:{label:"vmdk",value:"vmdk"}}),t("el-option",{attrs:{label:"vpc",value:"vpc"}})],1)],1),t("el-form-item",[t("el-upload",{ref:"upload",staticClass:"upload-demo",staticStyle:{"max-width":"300px"},attrs:{action:e.get_upload_uri(),limit:1,"on-success":e.on_upload_success,"on-error":e.on_upload_error,name:"volume",data:e.upload_volume,"file-list":e.upload_file_list,"auto-upload":!1,"show-file-list":!0}},[t("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("选择磁盘")])],1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",loading:e.uploading},on:{click:e.upload_volume_click}},[e._v("导入")]),t("el-button",{on:{click:e.show_volume_list}},[e._v("取消")])],1)],1)],1)],1)],1)],1)],1)},ae=[];s(57327),s(89554),s(54747),s(73210),s(69600),s(21249),s(92222);const re={name:"volumeView",components:{},data:function(){return{data_loading:!1,resize_dialog_visiable:!1,template_dialog_visiable:!1,snapshot_dialog_visiable:!1,download_dialog_visiable:!1,current_volume_id:0,current_loading:!1,uploading:!1,show_type:-1,show_volume:{},create_volume:{description:"",storageId:0,volumeType:"qcow2",volumeSize:100},upload_file_list:[],upload_volume:{description:"",storageId:0,volumeType:"qcow2"},download_volume:{volumeType:"qcow2",volumeId:0},clone_volume:{sourceVolumeId:0,description:"",storageId:0,volumeType:"qcow2"},migrate_volume:{sourceVolumeId:0,storageId:0,volumeType:"qcow2"},resize_volume:{volumeId:0,size:100},template_volume:{volumeId:0,name:""},snapshot_volume:{volumeId:0,snapshotName:"",snapshotVolumeType:"qcow2"},keyword:"",volumes:[],storages:[],select_volumes:[],current_page:1,page_size:10,total_size:0}},mixins:[C],mounted:function(){var e=this;this.current_volume_id=this.$route.query.id,this.current_volume_id?(this.show_type,this.current_loading=!0,Ct({volumeId:this.current_volume_id}).then((function(t){0===t.code?e.show_volume_info(t.data):e.$alert("获取磁盘信息失败:".concat(t.message),"提示",{dangerouslyUseHTMLString:!0,confirmButtonText:"返回",type:"error"}).then((function(){e.show_type=0}))}))["finally"]((function(){e.current_loading=!1}))):this.show_type=0,this.init_view(),this.init_notify()},computed:{show_table_volumes:function(){return this.volumes.filter((function(e){return void 0===e.isShow||e.isShow}))}},methods:{handleSelectionChange:function(e){this.select_volumes=e},get_upload_uri:function(){return"./api/volume/upload"},init_view:function(){var e=this;return(0,x.Z)((0,I.Z)().mark((function t(){return(0,I.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.data_loading=!0,t.next=3,ut().then((function(t){0==t.code&&(e.storages=t.data)}));case 3:return t.next=5,St().then((function(t){0==t.code&&(e.volumes=t.data,e.update_show_page())}))["finally"]((function(){e.data_loading=!1}));case 5:case"end":return t.stop()}}),t)})))()},on_current_page_change:function(e){this.current_page=e,this.update_show_page()},on_page_size_change:function(e){this.page_size=e,this.update_show_page()},update_show_page:function(){var e=this,t=0;this.volumes.forEach((function(s,o){var a=!0,r=e.keyword.trim().toLowerCase();if(""!==r){var n=s.attach?s.attach.description.toLowerCase():"";a=""+s.volumeId===r||s.description.toLowerCase().indexOf(r)>=0||n.indexOf(r)>=0}a?(t++,t<=e.page_size*(e.current_page-1)||t>e.page_size*e.current_page?s.isShow=!1:s.isShow=!0):s.isShow=!1,e.$set(e.volumes,o,s)})),this.total_size=t},get_storage_name:function(e){var t=this.storages.find((function(t){return t.storageId===e}))||{name:"-"};return t.name},get_volume_status:function(e){switch(e.status){case 0:return"正在创建";case 1:return"已就绪";case 2:return"正在挂载";case 3:return"正在卸载";case 4:return"正在克隆";case 5:return"创建模版";case 6:return"创建快照";case 7:return"正在迁移";case 8:return"正在扩容";case 9:return"正在销毁";case 10:return"磁盘错误";default:return"未知状态[".concat(e.status,"]")}},update_volume_info:function(e){var t=this.volumes.findIndex((function(t){return t.volumeId===e.volumeId}));if(t>=0)this.$set(this.volumes,t,e);else{var s=this.page_size*(this.current_page-1);this.volumes.splice(s,0,e)}this.show_volume&&this.show_volume.volumeId===e.volumeId&&(this.show_volume=e),this.update_show_page(),this.$forceUpdate()},handle_notify_message:function(e){var t=this;2===e.type&&Ct({volumeId:e.id}).then((function(s){if(0==s.code)t.update_volume_info(s.data);else if(4000001==s.code){var o=t.volumes.findIndex((function(t){return t.volumeId===e.id}));o>=0&&t.volumes.splice(o,1)}}))},show_volume_list:function(){this.show_type=0},show_create_volume:function(){this.$refs["createForm"]&&this.$refs["createForm"].resetFields(),this.show_type=2},show_upload_volume:function(){this.$refs["uploadForm"]&&this.$refs["uploadForm"].resetFields(),this.uploading=!1,this.upload_file_list=[],this.show_type=5},upload_volume_click:function(){this.uploading=!0,this.$refs.upload.submit()},show_volume_info:function(e){var t=this;return(0,x.Z)((0,I.Z)().mark((function s(){return(0,I.Z)().wrap((function(s){while(1)switch(s.prev=s.next){case 0:return t.show_volume=e,s.next=3,t.init_volume_template(e);case 3:t.show_type=1;case 4:case"end":return s.stop()}}),s)})))()},init_volume_template:function(e){return(0,x.Z)((0,I.Z)().mark((function t(){return(0,I.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(0!==e.templateId){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,gt({templateId:e.templateId}).then((function(t){0==t.code&&(e.template=t.data)}));case 4:case"end":return t.stop()}}),t)})))()},create_volume_click:function(){var e=this;zt(this.create_volume).then((function(t){0===t.code?(e.update_volume_info(t.data),e.show_type=0):e.$notify.error({title:"错误",message:"创建磁盘失败:".concat(t.message)})}))},update_volume_status:function(e,t){var s=this.volumes.find((function(t){return t.volumeId===e}));s&&(s.status=t)},menu_command_click:function(e){switch(e.command){case"info":this.show_volume_info(e.volume);break;case"resize":this.show_resize_volume_click(e.volume);break;case"snapshote":this.show_create_volume_snapshot_click(e.volume);break;case"clone":this.show_clone_volume_click(e.volume);break;case"migrate":this.show_migrate_volume_click(e.volume);break;case"template":this.show_create_volume_template_click(e.volume);break;case"destroy":this.destroy_volume(e.volume);break}},show_download_volume_click:function(e){this.download_volume.volumeId=e.volumeId,this.clone_volume.volumeType=e.type,this.download_dialog_visiable=!0},show_clone_volume_click:function(e){this.clone_volume.sourceVolumeId=e.volumeId,this.clone_volume.volumeType=e.type,this.clone_volume.description="Clone-"+e.description,this.clone_volume.storageId=e.storageId,this.show_type=3},show_migrate_volume_click:function(e){this.migrate_volume.sourceVolumeId=e.volumeId,this.migrate_volume.volumeType=e.type,this.migrate_volume.storageId=e.storageId,this.show_type=4},show_create_volume_template_click:function(e){this.template_volume.volumeId=e.volumeId,this.template_volume.name="",this.template_dialog_visiable=!0},show_resize_volume_click:function(e){this.resize_volume.volumeId=e.volumeId,this.resize_volume.size=100,this.resize_dialog_visiable=!0},show_create_volume_snapshot_click:function(e){this.snapshot_volume.volumeId=e.volumeId,this.snapshot_volume.name="",this.snapshot_volume.snapshotVolumeType=e.type,this.snapshot_dialog_visiable=!0},clone_volume_click:function(){var e=this;this.$confirm("克隆磁盘, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Bt(e.clone_volume).then((function(t){0===t.code?(e.update_volume_info(t.data.clone),e.update_volume_info(t.data.source),e.show_type=0):e.$notify.error({title:"错误",message:"克隆磁盘失败:".concat(t.message)})}))}))["catch"]((function(){}))},migrate_volume_click:function(){var e=this;this.$confirm("迁移磁盘, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){qt(e.migrate_volume).then((function(t){0===t.code?(e.update_volume_info(t.data.migrate),e.update_volume_info(t.data.source),e.show_type=0):e.$notify.error({title:"错误",message:"迁移磁盘失败:".concat(t.message)})}))}))["catch"]((function(){}))},resize_volume_click:function(){var e=this;this.$confirm("扩容磁盘, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Zt(e.resize_volume).then((function(t){0===t.code?(e.update_volume_info(t.data),e.resize_dialog_visiable=!1):e.$notify.error({title:"错误",message:"扩容磁盘失败:".concat(t.message)})}))}))["catch"]((function(){}))},create_volume_template_click:function(){var e=this;this.$confirm("创建磁盘模版, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){vt(e.template_volume).then((function(t){0===t.code?(e.update_volume_status(e.template_volume.volumeId,5),e.template_dialog_visiable=!1):e.$notify.error({title:"错误",message:"创建磁盘模版失败:".concat(t.message)})}))}))["catch"]((function(){}))},create_volume_snapshot_click:function(){var e=this;this.$confirm("创建磁盘快照, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){xt(e.snapshot_volume).then((function(t){0===t.code?(e.update_volume_status(e.snapshot_volume.volumeId,6),e.snapshot_dialog_visiable=!1):e.$notify.error({title:"错误",message:"创建磁盘快照失败:".concat(t.message)})}))}))["catch"]((function(){}))},get_volume_desplay_size:function(e){return e>1099511627776?(e/1099511627776).toFixed(2)+" TB":e>1073741824?(e/1073741824).toFixed(2)+" GB":e>1048576?(e/1048576).toFixed(2)+" MB":e>1024?(e/1024).toFixed(2)+"  KB":e+"  bytes"},destroy_volume:function(e){var t=this;this.$confirm("删除磁盘, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){console.log(e),Pt({volumeId:e.volumeId}).then((function(e){0===e.code?(t.update_volume_info(e.data),t.show_type=0):t.$notify.error({title:"错误",message:"删除磁盘失败:".concat(e.message)})}))}))["catch"]((function(){}))},batch_destroy_volume_click:function(){var e=this;this.$confirm("批量删除所选磁盘, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var t=e.select_volumes.map((function(e){return e.volumeId})).join(",");Ft({volumeIds:t}).then((function(t){0===t.code?t.data.filter((function(t){e.update_volume_info(t)})):e.$notify.error({title:"错误",message:"批量删除磁盘:".concat(t.message)})}))}))["catch"]((function(){}))},on_upload_success:function(e){this.uploading=!1,0===e.code?(this.update_volume_info(e.data),this.show_type=0,this.upload_file_list=[]):(this.upload_file_list=[],this.$notify.error({title:"错误",message:"上传磁盘失败:".concat(e.message)}))},on_upload_error:function(){this.uploading=!1,this.upload_file_list=[],this.$notify.error({title:"错误",message:"磁盘上传失败。"})},download_volume_click:function(){var e="./api/volume/download?volumeId=".concat(this.download_volume.volumeId,"&volumeType=").concat(this.download_volume.volumeType);window.open(e,"_blank"),this.download_dialog_visiable=!1}}},ne=re;var le=(0,u.Z)(ne,oe,ae,!1,null,"8de52d68",null);const ie=le.exports;var ce=function(){var e=this,t=e._self._c;return t("div",[t("el-container",[t("el-main",[t("el-card",{directives:[{name:"show",rawName:"v-show",value:0===this.show_type,expression:"this.show_type === 0"}],staticClass:"box-card"},[t("el-row",{staticClass:"clearfix",staticStyle:{height:"20px"},attrs:{slot:"header"},slot:"header"},[t("el-button",{staticStyle:{float:"left",padding:"3px 0"},attrs:{type:"text"},on:{click:e.show_crate_scheme_info_click}},[e._v("创建计算方案")])],1),t("el-row",[t("el-table",{staticStyle:{width:"100%"},attrs:{"v-loading":e.data_loading,data:e.schemes}},[t("el-table-column",{attrs:{label:"ID",prop:"schemeId",width:"80"}}),t("el-table-column",{attrs:{label:"名称",prop:"name",width:"300"}}),t("el-table-column",{attrs:{label:"CPU",prop:"cpu",width:"120"}}),t("el-table-column",{attrs:{label:"内存",prop:"memory",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.get_memory_desplay(t.row.memory))+" ")]}}])}),t("el-table-column",{attrs:{label:"操作","min-width":"380"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{type:"",size:"mini"},on:{click:function(t){return e.show_scheme_info_click(s.row)}}},[e._v("详情")]),t("el-button",{attrs:{type:"",size:"mini"},on:{click:function(t){return e.show_modify_scheme(s.row)}}},[e._v("修改")]),t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.destroy_scheme(s.row)}}},[e._v("删除")])]}}])})],1)],1)],1),t("el-card",{directives:[{name:"show",rawName:"v-show",value:1===this.show_type,expression:"this.show_type === 1"}],staticClass:"box-card"},[t("el-row",{attrs:{slot:"header"},slot:"header"},[t("el-page-header",{attrs:{content:"计算方案详情"},on:{back:e.show_scheme_list}})],1),t("el-row",{staticStyle:{"text-align":"left",margin:"20px 0"}},[t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.destroy_scheme(e.show_scheme)}}},[e._v("删除")])],1),t("el-row",[t("el-descriptions",{attrs:{column:2,size:"medium",border:""}},[t("el-descriptions-item",{attrs:{label:"ID"}},[e._v(e._s(e.show_scheme.schemeId))]),t("el-descriptions-item",{attrs:{label:"名称"}},[e._v(e._s(e.show_scheme.name))]),t("el-descriptions-item",{attrs:{label:"配额"}},[e._v(e._s(e.show_scheme.speed))]),t("el-descriptions-item",{attrs:{label:"CPU"}},[e._v(e._s(e.show_scheme.cpu))]),t("el-descriptions-item",{attrs:{label:"内存"}},[e._v(e._s(e.get_memory_desplay(e.show_scheme.memory)))]),t("el-descriptions-item",{attrs:{label:"Cores"}},[e._v(e._s(e.show_scheme.cores))]),t("el-descriptions-item",{attrs:{label:"Sockets"}},[e._v(e._s(e.show_scheme.sockets))]),t("el-descriptions-item",{attrs:{label:"Threads"}},[e._v(e._s(e.show_scheme.threads))])],1)],1)],1),t("el-card",{directives:[{name:"show",rawName:"v-show",value:2===this.show_type,expression:"this.show_type === 2"}],staticClass:"box-card"},[t("el-row",{attrs:{slot:"header"},slot:"header"},[t("el-page-header",{staticStyle:{color:"#409eff"},attrs:{content:"创建计算方案"},on:{back:function(t){return e.show_scheme_list()}}})],1),t("el-row",[t("el-form",{ref:"createForm",staticClass:"demo-ruleForm",attrs:{model:e.create_scheme,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"名称",prop:"name"}},[t("el-input",{model:{value:e.create_scheme.name,callback:function(t){e.$set(e.create_scheme,"name",t)},expression:"create_scheme.name"}})],1),t("el-form-item",{attrs:{label:"CPU",prop:"cpu"}},[t("el-input",{model:{value:e.create_scheme.cpu,callback:function(t){e.$set(e.create_scheme,"cpu",t)},expression:"create_scheme.cpu"}})],1),t("el-form-item",{attrs:{label:"内存(MB)",prop:"memory"}},[t("el-input",{model:{value:e.create_scheme.memory,callback:function(t){e.$set(e.create_scheme,"memory",t)},expression:"create_scheme.memory"}})],1),t("el-form-item",{attrs:{label:"配额",prop:"speed"}},[t("el-input",{model:{value:e.create_scheme.speed,callback:function(t){e.$set(e.create_scheme,"speed",t)},expression:"create_scheme.speed"}})],1),t("el-form-item",{attrs:{label:"Cores",prop:"cores"}},[t("el-input",{model:{value:e.create_scheme.cores,callback:function(t){e.$set(e.create_scheme,"cores",t)},expression:"create_scheme.cores"}})],1),t("el-form-item",{attrs:{label:"Sockets",prop:"sockets"}},[t("el-input",{model:{value:e.create_scheme.sockets,callback:function(t){e.$set(e.create_scheme,"sockets",t)},expression:"create_scheme.sockets"}})],1),t("el-form-item",{attrs:{label:"Threads",prop:"threads"}},[t("el-input",{model:{value:e.create_scheme.threads,callback:function(t){e.$set(e.create_scheme,"threads",t)},expression:"create_scheme.threads"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.create_scheme_click}},[e._v("立即创建")]),t("el-button",{on:{click:e.show_scheme_list}},[e._v("取消")])],1)],1)],1)],1),t("el-card",{directives:[{name:"show",rawName:"v-show",value:3===this.show_type,expression:"this.show_type === 3"}],staticClass:"box-card"},[t("el-row",{attrs:{slot:"header"},slot:"header"},[t("el-page-header",{staticStyle:{color:"#409eff"},attrs:{content:"修改计算方案"},on:{back:function(t){return e.show_scheme_list()}}})],1),t("el-row",[t("el-form",{staticClass:"demo-ruleForm",attrs:{model:e.modify_scheme,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"名称",prop:"name"}},[t("el-input",{model:{value:e.modify_scheme.name,callback:function(t){e.$set(e.modify_scheme,"name",t)},expression:"modify_scheme.name"}})],1),t("el-form-item",{attrs:{label:"CPU",prop:"cpu"}},[t("el-input",{model:{value:e.modify_scheme.cpu,callback:function(t){e.$set(e.modify_scheme,"cpu",t)},expression:"modify_scheme.cpu"}})],1),t("el-form-item",{attrs:{label:"内存(MB)",prop:"memory"}},[t("el-input",{model:{value:e.modify_scheme.memory,callback:function(t){e.$set(e.modify_scheme,"memory",t)},expression:"modify_scheme.memory"}})],1),t("el-form-item",{attrs:{label:"配额",prop:"speed"}},[t("el-input",{model:{value:e.modify_scheme.speed,callback:function(t){e.$set(e.modify_scheme,"speed",t)},expression:"modify_scheme.speed"}})],1),t("el-form-item",{attrs:{label:"Cores",prop:"cores"}},[t("el-input",{model:{value:e.modify_scheme.cores,callback:function(t){e.$set(e.modify_scheme,"cores",t)},expression:"modify_scheme.cores"}})],1),t("el-form-item",{attrs:{label:"Sockets",prop:"sockets"}},[t("el-input",{model:{value:e.modify_scheme.sockets,callback:function(t){e.$set(e.modify_scheme,"sockets",t)},expression:"modify_scheme.sockets"}})],1),t("el-form-item",{attrs:{label:"Threads",prop:"threads"}},[t("el-input",{model:{value:e.modify_scheme.threads,callback:function(t){e.$set(e.modify_scheme,"threads",t)},expression:"modify_scheme.threads"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.modify_scheme_click}},[e._v("修改")]),t("el-button",{on:{click:function(t){e.show_type=0}}},[e._v("取消")])],1)],1)],1)],1)],1)],1)],1)},ue=[];const de={name:"schemeView",components:{},data:function(){return{data_loading:!1,current_loading:!1,current_scheme_id:0,show_type:-1,show_scheme:{},create_scheme:{name:"",cpu:1,memory:512,speed:0,sockets:0,cores:0,threads:0},modify_scheme:{schemeId:0,name:"",cpu:1,memory:512,speed:0,sockets:0,cores:0,threads:0},schemes:[]}},mixins:[C],mounted:function(){var e=this;this.current_scheme_id=this.$route.query.id,this.current_scheme_id?(this.show_type,this.current_loading=!0,Vt({schemeId:this.current_scheme_id}).then((function(t){0===t.code?e.show_scheme_info_click(t.data):e.$alert("获取计算方案信息失败:".concat(t.message),"提示",{dangerouslyUseHTMLString:!0,confirmButtonText:"返回",type:"error"}).then((function(){e.show_type=0}))}))["finally"]((function(){e.current_loading=!1}))):this.show_type=0,this.init_notify(),this.init_view()},methods:{init_view:function(){var e=this;return(0,x.Z)((0,I.Z)().mark((function t(){return(0,I.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.data_loading=!0,t.next=3,Nt().then((function(t){0==t.code&&(e.schemes=t.data)}))["finally"]((function(){e.data_loading=!1}));case 3:case"end":return t.stop()}}),t)})))()},update_scheme_info:function(e){var t=this.schemes.findIndex((function(t){return t.schemeId===e.schemeId}));t>=0?this.$set(this.schemes,t,e):this.schemes.push(e),this.show_scheme&&this.show_scheme.schemeId===e.schemeId&&(this.show_scheme=e),this.$forceUpdate()},handle_notify_message:function(e){var t=this;8===e.type&&Vt({schemeId:e.id}).then((function(s){if(0==s.code)t.update_scheme_info(s.data);else if(8000001==s.code){var o=t.schemes.findIndex((function(t){return t.networkId===e.id}));o>=0&&t.schemes.splice(o,1)}t.$forceUpdate()}))},show_scheme_list:function(){this.show_type=0},show_crate_scheme_info_click:function(){this.$refs["createForm"]&&this.$refs["createForm"].resetFields(),this.show_type=2},show_modify_scheme:function(e){this.modify_scheme.schemeId=e.schemeId,this.modify_scheme.name=e.name,this.modify_scheme.cpu=e.cpu,this.modify_scheme.memory=e.memory/1024,this.modify_scheme.speed=e.speed,this.modify_scheme.sockets=e.sockets,this.modify_scheme.cores=e.cores,this.modify_scheme.threads=e.threads,this.show_type=3},show_scheme_info_click:function(e){this.show_scheme=e,this.show_type=1},create_scheme_click:function(){var e=this;Ot(this.create_scheme).then((function(t){0===t.code?(e.update_scheme_info(t.data),e.show_type=0):e.$notify.error({title:"错误",message:"创建计算方案失败:".concat(t.message)})}))},modify_scheme_click:function(){var e=this;this.$confirm("修改计算方案, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Dt(e.modify_scheme).then((function(t){0===t.code?(e.update_scheme_info(t.data),e.show_type=0):e.$notify.error({title:"错误",message:"修改计算方案失败:".concat(t.message)})}))}))["catch"]((function(){}))},get_memory_desplay:function(e){return e>1048576?parseInt(e/1048576)+" GB":e>1024?parseInt(e/1024)+"  MB":void 0},destroy_scheme:function(e){var t=this;this.$confirm("删除计算方案, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Et({schemeId:e.schemeId}).then((function(s){if(0===s.code){var o=t.schemes.findIndex((function(t){return t.schemeId===e.schemeId}));o>=0&&t.schemes.splice(o,1),t.show_type=0}else t.$notify.error({title:"错误",message:"删除计算方案失败:".concat(s.message)})}))}))["catch"]((function(){}))}}},_e=de;var pe=(0,u.Z)(_e,ce,ue,!1,null,"7f7266ab",null);const he=pe.exports;var me=function(){var e=this,t=e._self._c;return t("div",[t("el-container",[t("el-main",[t("el-card",{directives:[{name:"show",rawName:"v-show",value:0===this.show_type,expression:"this.show_type === 0"}],staticClass:"box-card"},[t("el-row",{staticClass:"clearfix",staticStyle:{height:"20px"},attrs:{slot:"header"},slot:"header"},[t("el-col",{attrs:{span:14}},[t("el-link",{attrs:{type:"primary"},on:{click:e.show_create_guest_click}},[e._v("创建虚拟机")]),t("el-link",{staticStyle:{padding:"0 10px"},attrs:{disabled:!e.select_guests.length,type:"primary"},on:{click:e.batch_start_guest_click}},[e._v("批量启动")]),t("el-link",{attrs:{disabled:!e.select_guests.length,type:"danger"},on:{click:e.batch_stop_guest_click}},[e._v("批量停止")])],1),t("el-col",{attrs:{span:10}},[t("el-input",{staticStyle:{float:"right",width:"300px","margin-bottom":"10px"},attrs:{placeholder:"请输入搜索关键字"},on:{input:e.update_guest_show_page},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}})],1)],1),t("el-row",[t("el-table",{staticStyle:{width:"100%"},attrs:{"v-loading":e.data_loading,data:e.show_table_guests},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"55"}}),t("el-table-column",{attrs:{label:"ID",prop:"guestId",width:"80"}}),t("el-table-column",{attrs:{label:"实例名",prop:"name",width:"180"}}),t("el-table-column",{attrs:{label:"标签",prop:"description",width:"180"}}),t("el-table-column",{attrs:{label:"IP地址",prop:"guestIp",width:"150"}}),t("el-table-column",{attrs:{label:"配置",prop:"cpu",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.cpu)+"核/"+e._s(e.get_memory_desplay(t.row.memory)))]}}])}),t("el-table-column",{attrs:{label:"类型",width:"100"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",[e._v(e._s(0===s.row.type?"系统主机":"用户主机"))])]}}])}),t("el-table-column",{attrs:{label:"状态",prop:"status",width:"100"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{attrs:{type:2===s.row.status?"success":"danger"}},[e._v(e._s(e.get_guest_status(s.row)))])]}}])}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-dropdown",{attrs:{size:"small","split-button":"",placement:"bottom-end",type:"primary"},on:{click:function(t){return e.show_guest_info_click(s.row)},command:e.menu_command_click}},[e._v(" 虚拟机管理 "),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:{guest:s.row,command:"info"}}},[e._v("虚拟机详情")]),t("el-dropdown-item",{attrs:{command:{guest:s.row,command:"start"},divided:"",disabled:4!==s.row.status}},[e._v("启动虚拟机")]),t("el-dropdown-item",{attrs:{command:{guest:s.row,command:"stop"},disabled:2!==s.row.status}},[e._v("停止虚拟机")]),t("el-dropdown-item",{attrs:{command:{guest:s.row,command:"vnc"},disabled:2!==s.row.status}},[e._v("远程桌面")]),t("el-dropdown-item",{attrs:{command:{guest:s.row,command:"reboot"},disabled:2!==s.row.status}},[e._v("重启虚拟机")]),0!==s.row.type?t("el-dropdown-item",{attrs:{command:{guest:s.row,command:"attach_cd"},disabled:0!==s.row.cdRoom}},[e._v("挂载光驱")]):e._e(),0!==s.row.type?t("el-dropdown-item",{attrs:{command:{guest:s.row,command:"detach_cd"},disabled:0===s.row.cdRoom}},[e._v("卸载光驱")]):e._e(),t("el-dropdown-item",{attrs:{command:{guest:s.row,command:"destroy"},divided:""}},[e._v("销毁虚拟机")])],1)],1)]}}])})],1),t("el-pagination",{attrs:{"current-page":e.current_page,"page-size":e.page_size,"page-sizes":[5,10,20,50,100,200],total:e.total_size,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.on_page_size_change,"current-change":e.on_current_page_change}})],1)],1),t("el-card",{directives:[{name:"show",rawName:"v-show",value:1===this.show_type,expression:"this.show_type === 1"}],staticClass:"box-card"},[t("el-row",{attrs:{slot:"header"},slot:"header"},[t("el-page-header",{attrs:{content:"虚拟机详情"},on:{back:e.show_guest_list_page}})],1),t("el-row",{staticStyle:{"text-align":"left",margin:"20px 0"}},[t("el-button",{attrs:{type:"primary",size:"mini",disabled:4!==e.show_guest_info.current_guest.status},on:{click:function(t){return e.show_start_guest_click(e.show_guest_info.current_guest)}}},[e._v("启动虚拟机")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.show_stop_guest_click(e.show_guest_info.current_guest)}}},[e._v("停止虚拟机")]),0!==e.show_guest_info.current_guest.type?t("el-button",{attrs:{type:"primary",size:"mini",disabled:2!==e.show_guest_info.current_guest.status},on:{click:function(t){return e.reboot_guest_click(e.show_guest_info.current_guest)}}},[e._v("重启虚拟机")]):e._e(),0!==e.show_guest_info.current_guest.type?t("el-button",{attrs:{type:"primary",size:"mini",disabled:4!==e.show_guest_info.current_guest.status},on:{click:function(t){return e.show_reinstall_guest_click(e.show_guest_info.current_guest)}}},[e._v("重装系统")]):e._e(),0!==e.show_guest_info.current_guest.type?t("el-button",{attrs:{type:"primary",size:"mini",disabled:4!==e.show_guest_info.current_guest.status},on:{click:function(t){return e.show_modify_guest_click(e.show_guest_info.current_guest)}}},[e._v("修改配置")]):e._e(),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.vnc_click(e.show_guest_info.current_guest)}}},[e._v("远程桌面")]),0!==e.show_guest_info.current_guest.type?t("el-button",{attrs:{type:"primary",size:"mini",disabled:0!==e.show_guest_info.current_guest.cdRoom},on:{click:function(t){return e.show_attach_cd_room_click(e.show_guest_info.current_guest)}}},[e._v("挂载光驱")]):e._e(),0!==e.show_guest_info.current_guest.type?t("el-button",{attrs:{type:"primary",size:"mini",disabled:0===e.show_guest_info.current_guest.cdRoom},on:{click:function(t){return e.detach_guest_cd_room_click(e.show_guest_info.current_guest)}}},[e._v("卸载光驱")]):e._e(),0!==e.show_guest_info.current_guest.type?t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.show_attach_network_click(e.show_guest_info.current_guest)}}},[e._v("添加网卡")]):e._e(),0!==e.show_guest_info.current_guest.type?t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.show_attach_volume_click(e.show_guest_info.current_guest)}}},[e._v("挂载磁盘")]):e._e(),t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.destroy_guest(e.show_guest_info.current_guest)}}},[e._v("销毁虚拟机")])],1),t("el-row",[t("el-descriptions",{attrs:{column:2,size:"medium",border:""}},[t("el-descriptions-item",{attrs:{label:"ID"}},[e._v(e._s(e.show_guest_info.current_guest.guestId))]),t("el-descriptions-item",{attrs:{label:"虚拟机名"}},[e._v(e._s(e.show_guest_info.current_guest.description))]),t("el-descriptions-item",{attrs:{label:"总线类型"}},[e._v(e._s(e.show_guest_info.current_guest.busType))]),t("el-descriptions-item",{attrs:{label:"CPU"}},[e._v(e._s(e.show_guest_info.current_guest.cpu)+"核")]),t("el-descriptions-item",{attrs:{label:"内存"}},[e._v(e._s(e.get_memory_desplay(e.show_guest_info.current_guest.memory)))]),t("el-descriptions-item",{attrs:{label:"配额"}},[e._v(e._s(e.show_guest_info.current_guest.speed))]),t("el-descriptions-item",{attrs:{label:"光盘"}},[e._v(e._s(e.show_guest_info.template.name))]),t("el-descriptions-item",{attrs:{label:"运行主机"}},[0!==e.show_guest_info.host.hostId?t("el-link",{attrs:{href:"/#/Host?id=".concat(e.show_guest_info.host.hostId),type:"primary",underline:!1}},[e._v(e._s(e.show_guest_info.host.displayName))]):e._e(),0===e.show_guest_info.host.hostId?t("span",{attrs:{underline:!1}},[e._v(e._s(e.show_guest_info.host.displayName))]):e._e()],1),t("el-descriptions-item",{attrs:{label:"架构方案"}},[0!==e.show_guest_info.scheme.schemeId?t("el-link",{attrs:{href:"/#/Scheme?id=".concat(e.show_guest_info.scheme.schemeId),type:"primary",underline:!1}},[e._v(e._s(e.show_guest_info.scheme.name))]):e._e(),0===e.show_guest_info.scheme.schemeId?t("span",{attrs:{underline:!1}},[e._v(e._s(e.show_guest_info.scheme.name))]):e._e()],1),t("el-descriptions-item",{attrs:{label:"虚拟机类型"}},[t("el-tag",[e._v(e._s(0===e.show_guest_info.current_guest.type?"系统":"用户"))])],1),t("el-descriptions-item",{attrs:{label:"虚拟机IP"}},[e._v(e._s(e.show_guest_info.current_guest.guestIp))]),t("el-descriptions-item",{attrs:{label:"状态"}},[t("el-tag",{attrs:{type:2===e.show_guest_info.current_guest.status?"success":"danger"}},[e._v(e._s(e.get_guest_status(e.show_guest_info.current_guest)))])],1)],1)],1),t("br"),t("el-row",[t("el-tabs",{attrs:{type:"border-card"}},[t("el-tab-pane",{attrs:{label:"磁盘"}},[t("el-table",{staticStyle:{width:"100%"},attrs:{"v-loading":e.show_guest_info.volume_loading,data:e.show_guest_info.volumes}},[t("el-table-column",{attrs:{label:"ID",prop:"volumeId",width:"80"}}),t("el-table-column",{attrs:{label:"描述",prop:"description",width:"200"}}),t("el-table-column",{attrs:{label:"容量",prop:"capacity",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.get_volume_desplay_size(t.row.capacity))+" ")]}}])}),t("el-table-column",{attrs:{label:"已使用",prop:"allocation",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.get_volume_desplay_size(t.row.allocation))+" ")]}}])}),t("el-table-column",{attrs:{label:"路径",prop:"path","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-link",{attrs:{type:"primary",href:"/#/Volume?id=".concat(s.row.volumeId)}},[e._v("详情")]),t("el-link",{staticStyle:{"margin-left":"10px"},attrs:{type:"danger",disabled:0===s.row.attach.deviceId},on:{click:function(t){return e.detach_volume_click(s.row)}}},[e._v("卸载磁盘")])]}}])})],1)],1),t("el-tab-pane",{attrs:{label:"网卡"}},[t("el-table",{staticStyle:{width:"100%"},attrs:{"v-loading":e.show_guest_info.network_loading,data:e.show_guest_info.networks}},[t("el-table-column",{attrs:{label:"MAC",prop:"mac",width:"200"}}),t("el-table-column",{attrs:{label:"IP",prop:"ip",width:"200"}}),t("el-table-column",{attrs:{label:"驱动类型",prop:"driveType",width:"150"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-link",{attrs:{type:"danger",disabled:0===s.row.deviceId},on:{click:function(t){return e.detach_network_click(s.row)}}},[e._v("卸载网卡")])]}}])})],1)],1)],1)],1)],1),t("el-card",{directives:[{name:"show",rawName:"v-show",value:2===this.show_type,expression:"this.show_type === 2"}],staticClass:"box-card"},[t("el-row",{attrs:{slot:"header"},slot:"header"},[t("el-page-header",{staticStyle:{color:"#409eff"},attrs:{content:"创建虚拟机"},on:{back:function(t){return e.show_guest_list_page()}}})],1),t("el-row",[t("el-form",{ref:"createForm",staticClass:"demo-ruleForm",attrs:{model:e.create_guest,"label-width":"100px"}},[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"名称",prop:"description"}},[t("el-input",{model:{value:e.create_guest.description,callback:function(t){e.$set(e.create_guest,"description",t)},expression:"create_guest.description"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"总线方式"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"总线方式"},model:{value:e.create_guest.busType,callback:function(t){e.$set(e.create_guest,"busType",t)},expression:"create_guest.busType"}},[t("el-option",{attrs:{label:"virtio",value:"virtio"}}),t("el-option",{attrs:{label:"ide",value:"ide"}}),t("el-option",{attrs:{label:"scsi",value:"scsi"}})],1)],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"运行主机"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.create_guest.hostId,callback:function(t){e.$set(e.create_guest,"hostId",t)},expression:"create_guest.hostId"}},[t("el-option",{attrs:{label:"随机",value:0}}),e._l(this.hosts,(function(e){return t("el-option",{key:e.hostId,attrs:{label:e.displayName,value:e.hostId}})}))],2)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"架构"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择架构"},model:{value:e.create_guest.schemeId,callback:function(t){e.$set(e.create_guest,"schemeId",t)},expression:"create_guest.schemeId"}},e._l(this.schemes,(function(e){return t("el-option",{key:e.schemeId,attrs:{label:e.name,value:e.schemeId}})})),1)],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"网络"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择网络"},model:{value:e.create_guest.networkId,callback:function(t){e.$set(e.create_guest,"networkId",t)},expression:"create_guest.networkId"}},e._l(this.networks,(function(e){return t("el-option",{key:e.networkId,attrs:{label:e.name,value:e.networkId}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"网络驱动"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择网卡驱动"},model:{value:e.create_guest.networkDeviceType,callback:function(t){e.$set(e.create_guest,"networkDeviceType",t)},expression:"create_guest.networkDeviceType"}},[t("el-option",{attrs:{label:"virtio",value:"virtio"}}),t("el-option",{attrs:{label:"rtl8139",value:"rtl8139"}})],1)],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"安装方式"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择安装方式"},model:{value:e.create_guest.type,callback:function(t){e.$set(e.create_guest,"type",t)},expression:"create_guest.type"}},[t("el-option",{attrs:{label:"ISO镜像",value:0}}),t("el-option",{attrs:{label:"模版安装",value:1}}),t("el-option",{attrs:{label:"快照安装",value:2}}),t("el-option",{attrs:{label:"现有磁盘",value:3}})],1)],1)],1),t("el-col",{attrs:{span:12}},[3!==e.create_guest.type?t("el-form-item",{attrs:{label:"磁盘类型"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.create_guest.volumeType,callback:function(t){e.$set(e.create_guest,"volumeType",t)},expression:"create_guest.volumeType"}},[t("el-option",{attrs:{label:"raw",value:"raw"}}),t("el-option",{attrs:{label:"qcow",value:"qcow"}}),t("el-option",{attrs:{label:"qcow2",value:"qcow2"}}),t("el-option",{attrs:{label:"vdi",value:"vdi"}}),t("el-option",{attrs:{label:"vmdk",value:"vmdk"}}),t("el-option",{attrs:{label:"vpc",value:"vpc"}})],1)],1):e._e()],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[0===e.create_guest.type?t("el-form-item",{attrs:{label:"ISO模版"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择光盘镜像"},model:{value:e.create_guest.isoTemplateId,callback:function(t){e.$set(e.create_guest,"isoTemplateId",t)},expression:"create_guest.isoTemplateId"}},e._l(this.iso_template,(function(e){return t("el-option",{key:e.templateId,attrs:{label:e.name,value:e.templateId}})})),1)],1):e._e(),1===e.create_guest.type?t("el-form-item",{attrs:{label:"系统模版"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择模版"},model:{value:e.create_guest.diskTemplateId,callback:function(t){e.$set(e.create_guest,"diskTemplateId",t)},expression:"create_guest.diskTemplateId"}},e._l(this.disk_template,(function(e){return t("el-option",{key:e.templateId,attrs:{label:e.name,value:e.templateId}})})),1)],1):e._e(),2===e.create_guest.type?t("el-form-item",{attrs:{label:"快照模版"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择系统快照"},model:{value:e.create_guest.snapshotVolumeId,callback:function(t){e.$set(e.create_guest,"snapshotVolumeId",t)},expression:"create_guest.snapshotVolumeId"}},e._l(this.snapshot_template,(function(e){return t("el-option",{key:e.snapshotVolumeId,attrs:{label:e.name,value:e.snapshotVolumeId}})})),1)],1):e._e(),3===e.create_guest.type?t("el-form-item",{attrs:{label:"可用磁盘"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择系统磁盘"},model:{value:e.create_guest.volumeId,callback:function(t){e.$set(e.create_guest,"volumeId",t)},expression:"create_guest.volumeId"}},e._l(this.attach_volumes,(function(e){return t("el-option",{key:e.volumeId,attrs:{label:e.description,value:e.volumeId}})})),1)],1):e._e()],1),t("el-col",{attrs:{span:12}},[3!==e.create_guest.type?t("el-form-item",{attrs:{label:"存储池"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.create_guest.storageId,callback:function(t){e.$set(e.create_guest,"storageId",t)},expression:"create_guest.storageId"}},[t("el-option",{attrs:{label:"随机",value:0}}),e._l(this.storages,(function(e){return t("el-option",{key:e.storageId,attrs:{label:e.name,value:e.storageId}})}))],2)],1):e._e()],1)],1),0===e.create_guest.type?t("el-form-item",{attrs:{label:"磁盘大小"}},[t("el-input",{model:{value:e.create_guest.size,callback:function(t){e.$set(e.create_guest,"size",t)},expression:"create_guest.size"}})],1):e._e(),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.create_guest_click}},[e._v("立即创建")]),t("el-button",{on:{click:e.show_guest_list_page}},[e._v("取消")])],1)],1)],1)],1),t("el-card",{directives:[{name:"show",rawName:"v-show",value:3===this.show_type,expression:"this.show_type === 3"}],staticClass:"box-card"},[t("el-row",{attrs:{slot:"header"},slot:"header"},[t("el-page-header",{staticStyle:{color:"#409eff"},attrs:{content:"重装虚拟机"},on:{back:function(t){return e.show_guest_list_page()}}})],1),t("el-row",[t("el-form",{ref:"reInstallForm",staticClass:"demo-ruleForm",attrs:{model:e.reinstall_guest,"label-width":"100px"}},[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"安装方式"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择安装方式"},model:{value:e.reinstall_guest.type,callback:function(t){e.$set(e.reinstall_guest,"type",t)},expression:"reinstall_guest.type"}},[t("el-option",{attrs:{label:"ISO镜像",value:0}}),t("el-option",{attrs:{label:"模版安装",value:1}}),t("el-option",{attrs:{label:"快照安装",value:2}}),t("el-option",{attrs:{label:"现有磁盘",value:3}})],1)],1)],1),t("el-col",{attrs:{span:12}},[3!==e.reinstall_guest.type?t("el-form-item",{attrs:{label:"磁盘类型"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.reinstall_guest.volumeType,callback:function(t){e.$set(e.reinstall_guest,"volumeType",t)},expression:"reinstall_guest.volumeType"}},[t("el-option",{attrs:{label:"raw",value:"raw"}}),t("el-option",{attrs:{label:"qcow",value:"qcow"}}),t("el-option",{attrs:{label:"qcow2",value:"qcow2"}}),t("el-option",{attrs:{label:"vdi",value:"vdi"}}),t("el-option",{attrs:{label:"vmdk",value:"vmdk"}}),t("el-option",{attrs:{label:"vpc",value:"vpc"}})],1)],1):e._e()],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[0===e.reinstall_guest.type?t("el-form-item",{attrs:{label:"ISO模版"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择光盘镜像"},model:{value:e.reinstall_guest.isoTemplateId,callback:function(t){e.$set(e.reinstall_guest,"isoTemplateId",t)},expression:"reinstall_guest.isoTemplateId"}},e._l(this.iso_template,(function(e){return t("el-option",{key:e.templateId,attrs:{label:e.name,value:e.templateId}})})),1)],1):e._e(),1===e.reinstall_guest.type?t("el-form-item",{attrs:{label:"系统模版"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择模版"},model:{value:e.reinstall_guest.diskTemplateId,callback:function(t){e.$set(e.reinstall_guest,"diskTemplateId",t)},expression:"reinstall_guest.diskTemplateId"}},e._l(this.disk_template,(function(e){return t("el-option",{key:e.templateId,attrs:{label:e.name,value:e.templateId}})})),1)],1):e._e(),2===e.reinstall_guest.type?t("el-form-item",{attrs:{label:"快照模版"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择系统快照"},model:{value:e.reinstall_guest.snapshotVolumeId,callback:function(t){e.$set(e.reinstall_guest,"snapshotVolumeId",t)},expression:"reinstall_guest.snapshotVolumeId"}},e._l(this.snapshot_template,(function(e){return t("el-option",{key:e.snapshotVolumeId,attrs:{label:e.name,value:e.snapshotVolumeId}})})),1)],1):e._e(),3===e.reinstall_guest.type?t("el-form-item",{attrs:{label:"可用磁盘"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择系统磁盘"},model:{value:e.reinstall_guest.volumeId,callback:function(t){e.$set(e.reinstall_guest,"volumeId",t)},expression:"reinstall_guest.volumeId"}},e._l(this.attach_volumes,(function(e){return t("el-option",{key:e.volumeId,attrs:{label:e.description,value:e.volumeId}})})),1)],1):e._e()],1),t("el-col",{attrs:{span:12}},[3!==e.reinstall_guest.type?t("el-form-item",{attrs:{label:"存储池"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.reinstall_guest.storageId,callback:function(t){e.$set(e.reinstall_guest,"storageId",t)},expression:"reinstall_guest.storageId"}},[t("el-option",{attrs:{label:"随机",value:0}}),e._l(this.storages,(function(e){return t("el-option",{key:e.storageId,attrs:{label:e.name,value:e.storageId}})}))],2)],1):e._e()],1)],1),0===e.reinstall_guest.type?t("el-form-item",{attrs:{label:"磁盘大小"}},[t("el-input",{model:{value:e.reinstall_guest.size,callback:function(t){e.$set(e.reinstall_guest,"size",t)},expression:"reinstall_guest.size"}})],1):e._e(),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.reinstall_guest_click}},[e._v("立即重装")]),t("el-button",{on:{click:e.show_guest_list_page}},[e._v("取消")])],1)],1)],1)],1)],1)],1),t("el-dialog",{attrs:{title:"启动虚拟机",visible:e.start_dialog_visiable,width:"400px"},on:{"update:visible":function(t){e.start_dialog_visiable=t}}},[t("el-form",{attrs:{model:e.start_guest,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"选择主机"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.start_guest.hostId,callback:function(t){e.$set(e.start_guest,"hostId",t)},expression:"start_guest.hostId"}},[t("el-option",{attrs:{label:"随机",value:0}}),e._l(this.hosts,(function(e){return t("el-option",{key:e.hostId,attrs:{label:e.displayName,value:e.hostId,"v-loading":!0}})}))],2)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.start_dialog_visiable=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.start_guest_click}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"关闭虚拟机",visible:e.stop_dialog_visiable,width:"400px"},on:{"update:visible":function(t){e.stop_dialog_visiable=t}}},[t("el-checkbox",{model:{value:e.stop_guest.force,callback:function(t){e.$set(e.stop_guest,"force",t)},expression:"stop_guest.force"}},[e._v("强制关闭")]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.stop_dialog_visiable=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.stop_guest_click}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"挂载光驱",visible:e.attach_cd_room_dialog_visiable,width:"400px"},on:{"update:visible":function(t){e.attach_cd_room_dialog_visiable=t}}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择光盘镜像"},model:{value:e.attach_cd_room_guest.templateId,callback:function(t){e.$set(e.attach_cd_room_guest,"templateId",t)},expression:"attach_cd_room_guest.templateId"}},e._l(this.iso_template,(function(e){return t("el-option",{key:e.templateId,attrs:{label:e.name,value:e.templateId}})})),1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.attach_cd_room_dialog_visiable=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.attach_cd_room_guest_click}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"挂载网卡",visible:e.attach_network_dialog_visiable,width:"400px"},on:{"update:visible":function(t){e.attach_network_dialog_visiable=t}}},[t("el-form",{attrs:{model:e.start_guest,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"网络"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择网络"},model:{value:e.attach_network_guest.networkId,callback:function(t){e.$set(e.attach_network_guest,"networkId",t)},expression:"attach_network_guest.networkId"}},e._l(this.networks,(function(e){return t("el-option",{key:e.networkId,attrs:{label:e.name,value:e.networkId}})})),1)],1),t("el-form-item",{attrs:{label:"驱动"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择网卡驱动"},model:{value:e.attach_network_guest.driveType,callback:function(t){e.$set(e.attach_network_guest,"driveType",t)},expression:"attach_network_guest.driveType"}},[t("el-option",{attrs:{label:"virtio",value:"virtio"}}),t("el-option",{attrs:{label:"rtl8139",value:"rtl8139"}})],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.attach_network_dialog_visiable=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.attach_network_click}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"挂载磁盘",visible:e.attach_volume_dialog_visiable,width:"400px"},on:{"update:visible":function(t){e.attach_volume_dialog_visiable=t}}},[t("el-form",{attrs:{model:e.start_guest,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"磁盘"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择磁盘"},model:{value:e.attach_volume_guest.volumeId,callback:function(t){e.$set(e.attach_volume_guest,"volumeId",t)},expression:"attach_volume_guest.volumeId"}},e._l(this.attach_volumes,(function(e){return t("el-option",{key:e.volumeId,attrs:{label:e.description,value:e.volumeId}})})),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.attach_volume_dialog_visiable=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.attach_volume_click}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"修改配置",visible:e.modify_guest_dialog_visiable,width:"400px"},on:{"update:visible":function(t){e.modify_guest_dialog_visiable=t}}},[t("el-form",{attrs:{model:e.start_guest,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"名称",prop:"description"}},[t("el-input",{model:{value:e.modify_guest.description,callback:function(t){e.$set(e.modify_guest,"description",t)},expression:"modify_guest.description"}})],1),t("el-form-item",{attrs:{label:"总线方式"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"总线方式"},model:{value:e.modify_guest.busType,callback:function(t){e.$set(e.modify_guest,"busType",t)},expression:"modify_guest.busType"}},[t("el-option",{attrs:{label:"virtio",value:"virtio"}}),t("el-option",{attrs:{label:"ide",value:"ide"}}),t("el-option",{attrs:{label:"scsi",value:"scsi"}})],1)],1),t("el-form-item",{attrs:{label:"计算方案"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择计算方案"},model:{value:e.modify_guest.schemeId,callback:function(t){e.$set(e.modify_guest,"schemeId",t)},expression:"modify_guest.schemeId"}},e._l(this.schemes,(function(e){return t("el-option",{key:e.schemeId,attrs:{label:e.name,value:e.schemeId}})})),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.modify_guest_dialog_visiable=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.modify_guest_click}},[e._v("确 定")])],1)],1)],1)},fe=[];const ge={name:"guestView",components:{},data:function(){return{current_guest_id:0,data_loading:!1,start_dialog_visiable:!1,stop_dialog_visiable:!1,attach_cd_room_dialog_visiable:!1,attach_network_dialog_visiable:!1,attach_volume_dialog_visiable:!1,modify_guest_dialog_visiable:!1,current_loading:!1,show_type:-1,show_guest_info:{guestId:0,volume_loading:!1,network_loading:!1,current_guest:{},host:{hostId:0,displayName:"-"},template:{templateId:0,name:"-"},scheme:{schemeId:0,name:"-"},volumes:[],networks:[]},create_guest:{type:0,description:"",busType:"virtio",hostId:0,schemeId:"",networkId:"",networkDeviceType:"virtio",volumeType:"qcow2",isoTemplateId:"",diskTemplateId:"",snapshotVolumeId:"",volumeId:"",storageId:0,size:100},reinstall_guest:{guestId:0,type:0,volumeType:"qcow2",isoTemplateId:"",diskTemplateId:"",snapshotVolumeId:"",volumeId:"",storageId:0,size:100},start_guest:{hostId:0,guestId:0},stop_guest:{hostId:0,force:!1},attach_cd_room_guest:{guestId:0,templateId:""},attach_network_guest:{guestId:0,networkId:"",driveType:"virtio"},attach_volume_guest:{guestId:0,volumeId:""},modify_guest:{guestId:0,busType:"",description:"",schemeId:""},keyword:"",guests:[],storages:[],hosts:[],networks:[],iso_template:[],disk_template:[],snapshot_template:[],attach_volumes:[],schemes:[],select_guests:[],current_page:1,page_size:10,total_size:0}},mixins:[C],mounted:function(){var e=this;this.current_guest_id=this.$route.query.id,this.current_guest_id?(this.show_type,this.current_loading=!0,Mt({guestId:this.current_guest_id}).then((function(t){0===t.code?e.show_guest_info_click(t.data):e.$alert("获取虚拟机信息失败:".concat(t.message),"提示",{dangerouslyUseHTMLString:!0,confirmButtonText:"返回",type:"error"}).then((function(){e.show_type=0}))}))["finally"]((function(){e.current_loading=!1}))):this.show_type=0,this.init_view(),this.init_notify()},computed:{show_table_guests:function(){return this.guests.filter((function(e){return void 0===e.isShow||e.isShow}))}},methods:{handleSelectionChange:function(e){this.select_guests=e},init_view:function(){var e=this;return(0,x.Z)((0,I.Z)().mark((function t(){return(0,I.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.data_loading=!0,t.next=3,Ht().then((function(t){0==t.code&&(e.guests=t.data,e.update_guest_show_page())}))["finally"]((function(){e.data_loading=!1}));case 3:case"end":return t.stop()}}),t)})))()},load_all_schemes:function(){var e=this;return(0,x.Z)((0,I.Z)().mark((function t(){return(0,I.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Nt().then((function(t){0===t.code&&(e.schemes=t.data)}));case 2:case"end":return t.stop()}}),t)})))()},load_all_attach_volumes:function(){var e=this;return(0,x.Z)((0,I.Z)().mark((function t(){return(0,I.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,$t().then((function(t){0===t.code&&(e.attach_volumes=t.data)}));case 2:case"end":return t.stop()}}),t)})))()},load_all_host:function(){var e=this;return(0,x.Z)((0,I.Z)().mark((function t(){return(0,I.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,at().then((function(t){0===t.code&&(e.hosts=t.data.filter((function(e){return 1==e.status})))}));case 2:case"end":return t.stop()}}),t)})))()},load_all_template:function(){var e=this;return(0,x.Z)((0,I.Z)().mark((function t(){return(0,I.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,ft().then((function(t){0===t.code&&(e.iso_template=t.data.filter((function(e){return 0==e.templateType&&2===e.status})),e.disk_template=t.data.filter((function(e){return 2==e.templateType&&2===e.status})))}));case 2:case"end":return t.stop()}}),t)})))()},load_all_storage:function(){var e=this;return(0,x.Z)((0,I.Z)().mark((function t(){return(0,I.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,ut().then((function(t){0==t.code&&(e.storages=t.data.filter((function(e){return 1==e.status})))}));case 2:case"end":return t.stop()}}),t)})))()},load_all_snapshot:function(){var e=this;return(0,x.Z)((0,I.Z)().mark((function t(){return(0,I.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,kt().then((function(t){0==t.code&&(e.snapshot_template=t.data.filter((function(e){return 1==e.status})))}));case 2:case"end":return t.stop()}}),t)})))()},load_all_networks:function(){var e=this;return(0,x.Z)((0,I.Z)().mark((function t(){return(0,I.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Qe().then((function(t){0===t.code&&(e.networks=t.data.filter((function(e){return 2===e.status})))}));case 2:case"end":return t.stop()}}),t)})))()},load_current_guest_template:function(e){var t=this;return(0,x.Z)((0,I.Z)().mark((function s(){return(0,I.Z)().wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(t.show_guest_info.template.templateId=e.cdRoom,t.show_guest_info.template.name="-",!(t.show_guest_info.template.templateId>0)){s.next=5;break}return s.next=5,gt({templateId:e.cdRoom}).then((function(e){0===e.code&&(t.show_guest_info.template.name=e.data.name)}));case 5:case"end":return s.stop()}}),s)})))()},load_current_guest_scheme:function(e){var t=this;return(0,x.Z)((0,I.Z)().mark((function s(){return(0,I.Z)().wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(t.show_guest_info.scheme.schemeId=e.schemeId,t.show_guest_info.scheme.name="-",!(t.show_guest_info.scheme.schemeId>0)){s.next=5;break}return s.next=5,Vt({schemeId:e.schemeId}).then((function(e){0===e.code&&(t.show_guest_info.scheme.name=e.data.name)}));case 5:case"end":return s.stop()}}),s)})))()},load_current_guest_host:function(e){var t=this;return(0,x.Z)((0,I.Z)().mark((function s(){return(0,I.Z)().wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(t.show_guest_info.host.hostId=e.hostId,t.show_guest_info.host.displayName="-",!(t.show_guest_info.host.hostId>0)){s.next=5;break}return s.next=5,rt({hostId:e.hostId}).then((function(e){0===e.code&&(t.show_guest_info.host.displayName=e.data.displayName)}));case 5:case"end":return s.stop()}}),s)})))()},load_current_guest_volume:function(e){var t=this;this.show_guest_info.volume_loading=!0,Ut({guestId:e.guestId}).then((function(e){0===e.code&&(t.show_guest_info.volumes=e.data)}))["finally"]((function(){t.show_guest_info.volume_loading=!1}))},load_current_guest_network:function(e){var t=this;this.show_guest_info.network_loading=!0,Gt({guestId:e.guestId}).then((function(e){0===e.code&&(t.show_guest_info.networks=e.data)}))["finally"]((function(){t.show_guest_info.network_loading=!1}))},on_current_page_change:function(e){this.current_page=e,this.update_guest_show_page()},on_page_size_change:function(e){this.page_size=e,this.update_guest_show_page()},update_guest_show_page:function(){var e=this,t=0;this.guests.forEach((function(s,o){var a=!0,r=e.keyword.trim().toLowerCase();""!==r&&(a=""+s.guestId===r||s.description.toLowerCase().indexOf(r)>=0||s.name.toLowerCase().indexOf(r)>=0||s.guestIp.toLowerCase().indexOf(r)>=0),a?(t++,t<=e.page_size*(e.current_page-1)||t>e.page_size*e.current_page?s.isShow=!1:s.isShow=!0):s.isShow=!1,e.$set(e.guests,o,s)})),this.total_size=t},update_guest_info:function(e){var t=this;return(0,x.Z)((0,I.Z)().mark((function s(){var o,a;return(0,I.Z)().wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(o=t.guests.findIndex((function(t){return t.guestId===e.guestId})),o>=0?t.$set(t.guests,o,e):1===e.type&&(a=t.page_size*(t.current_page-1),t.guests.splice(a,0,e)),t.show_guest_info.guestId!==e.guestId){s.next=12;break}return console.log("update guest",e.status),t.show_guest_info.current_guest=e,s.next=7,t.load_current_guest_template(e);case 7:return s.next=9,t.load_current_guest_host(e);case 9:return s.next=11,t.load_current_guest_scheme(e);case 11:t.$forceUpdate();case 12:case"end":return s.stop()}}),s)})))()},get_memory_desplay:function(e){return e>1048576?(e/1048576).toFixed(2)+" GB":e>1024?(e/1024).toFixed(2)+"  MB":void 0},get_volume_desplay_size:function(e){return e>1099511627776?(e/1099511627776).toFixed(2)+" TB":e>1073741824?(e/1073741824).toFixed(2)+" GB":e>1048576?(e/1048576).toFixed(2)+" MB":e>1024?(e/1024).toFixed(2)+"  KB":e+"  bytes"},get_guest_status:function(e){switch(e.status){case 0:return"正在创建";case 1:return"正在启动";case 2:return"正在运行";case 3:return"正在停止";case 4:return"已停止";case 5:return"重启中";case 6:return"虚拟机错误";default:return"未知状态[".concat(e.status,"]")}},handle_notify_message:function(e){var t=this;1===e.type&&Mt({guestId:e.id}).then((function(s){if(0==s.code)t.update_guest_info(s.data);else if(2000001==s.code){var o=t.guests.findIndex((function(t){return t.guestId===e.id}));o>=0&&t.guests.splice(o,1)}}))},show_guest_list_page:function(){this.show_type=0},show_create_guest_click:function(){var e=this;return(0,x.Z)((0,I.Z)().mark((function t(){return(0,I.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.load_all_attach_volumes(),e.load_all_host(),e.load_all_template(),e.load_all_storage(),e.load_all_schemes(),e.load_all_networks(),e.load_all_snapshot(),e.$refs["createForm"]&&e.$refs["createForm"].resetFields(),e.create_guest.isoTemplateId="",e.create_guest.diskTemplateId="",e.create_guest.snapshotVolumeId="",e.create_guest.volumeId="",e.create_guest.type=0,e.show_type=2;case 14:case"end":return t.stop()}}),t)})))()},create_guest_click:function(){var e=this;switch(this.create_guest.type){case 0:this.create_guest.diskTemplateId=0,this.create_guest.snapshotVolumeId=0,this.create_guest.volumeId=0;break;case 1:this.create_guest.isoTemplateId=0,this.create_guest.snapshotVolumeId=0,this.create_guest.volumeId=0,this.create_guest.size=0;break;case 2:this.create_guest.isoTemplateId=0,this.create_guest.diskTemplateId=0,this.create_guest.volumeId=0,this.create_guest.size=0;break;case 3:this.create_guest.isoTemplateId=0,this.create_guest.diskTemplateId=0,this.create_guest.snapshotVolumeId=0,this.create_guest.size=0;break}Kt(this.create_guest).then((function(t){0===t.code?(e.update_guest_info(t.data),e.show_type=0):e.$notify.error({title:"错误",message:"创建虚拟机失败:".concat(t.message)})}))},reinstall_guest_click:function(){var e=this;switch(this.reinstall_guest.type){case 0:this.reinstall_guest.diskTemplateId=0,this.reinstall_guest.snapshotVolumeId=0,this.reinstall_guest.volumeId=0;break;case 1:this.reinstall_guest.isoTemplateId=0,this.reinstall_guest.snapshotVolumeId=0,this.reinstall_guest.volumeId=0,this.reinstall_guest.size=0;break;case 2:this.reinstall_guest.isoTemplateId=0,this.reinstall_guest.diskTemplateId=0,this.reinstall_guest.volumeId=0,this.reinstall_guest.size=0;break;case 3:this.reinstall_guest.isoTemplateId=0,this.reinstall_guest.diskTemplateId=0,this.reinstall_guest.snapshotVolumeId=0,this.reinstall_guest.size=0;break}this.$confirm("重装虚拟机, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Xt(e.reinstall_guest).then((function(t){0===t.code?(e.update_guest_info(t.data),e.show_type=0):e.$notify.error({title:"错误",message:"重装虚拟机失败:".concat(t.message)})}))}))["catch"]((function(){}))},reboot_guest_click:function(e){var t=this;this.$confirm("重启当前虚拟机, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){es({guestId:e.guestId}).then((function(e){0===e.code?t.update_guest_info(e.data):t.$notify.error({title:"错误",message:"重启虚拟机失败:".concat(e.message)})}))}))["catch"]((function(){}))},start_guest_click:function(){var e=this;Jt(this.start_guest).then((function(t){0===t.code?(e.update_guest_info(t.data),e.start_dialog_visiable=!1):e.$notify.error({title:"错误",message:"启动虚拟机失败:".concat(t.message)})}))},stop_guest_click:function(){var e=this;this.$confirm("停止当前虚拟机, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Qt(e.stop_guest).then((function(t){0===t.code?(e.update_guest_info(t.data),e.stop_dialog_visiable=!1):e.$notify.error({title:"错误",message:"启动虚拟机失败:".concat(t.message)})}))}))["catch"]((function(){}))},detach_guest_cd_room_click:function(e){var t=this;os({guestId:e.guestId}).then((function(e){0===e.code?(t.update_guest_info(e.data),t.stop_dialog_visiable=!1):t.$notify.error({title:"错误",message:"卸载虚拟机光驱失败:".concat(e.message)})}))},attach_cd_room_guest_click:function(){var e=this;ss(this.attach_cd_room_guest).then((function(t){0===t.code?(e.update_guest_info(t.data),e.attach_cd_room_dialog_visiable=!1):e.$notify.error({title:"错误",message:"挂载虚拟机光驱失败:".concat(t.message)})}))},attach_network_click:function(){var e=this;ns(this.attach_network_guest).then((function(t){0===t.code?(e.update_guest_info(t.data.guest),e.show_guest_info.networks.push(t.data.network),e.attach_network_dialog_visiable=!1):e.$notify.error({title:"错误",message:"虚拟机附加网卡失败:".concat(t.message)})}))},detach_network_click:function(e){var t=this;this.$confirm("卸载当前挂载网卡, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){ls({guestId:e.guestId,guestNetworkId:e.guestNetworkId}).then((function(s){if(0===s.code){t.update_guest_info(s.data);var o=t.show_guest_info.networks.findIndex((function(t){return t.guestNetworkId===e.guestNetworkId}));o>=0&&t.show_guest_info.networks.splice(o,1)}else t.$notify.error({title:"错误",message:"虚拟机附加网卡失败:".concat(s.message)})}))}))["catch"]((function(){}))},detach_volume_click:function(e){var t=this;this.$confirm("卸载当前挂载磁盘, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var s=e.attach;rs({guestId:s.guestId,guestDiskId:s.guestDiskId}).then((function(e){if(0===e.code){t.update_guest_info(e.data);var o=t.show_guest_info.volumes.findIndex((function(e){return e.attach.guestDiskId===s.guestDiskId}));o>=0&&t.show_guest_info.volumes.splice(o,1)}else t.$notify.error({title:"错误",message:"卸载磁盘失败:".concat(e.message)})}))}))["catch"]((function(){}))},attach_volume_click:function(){var e=this;as(this.attach_volume_guest).then((function(t){0===t.code?(e.update_guest_info(t.data.guest),e.show_guest_info.volumes.push(t.data.volume),e.attach_volume_dialog_visiable=!1):e.$notify.error({title:"错误",message:" 挂载磁盘失败:".concat(t.message)})}))},modify_guest_click:function(){var e=this;ts(this.modify_guest).then((function(t){0===t.code?(e.update_guest_info(t.data),e.modify_guest_dialog_visiable=!1):e.$notify.error({title:"错误",message:" 修改主机信息失败:".concat(t.message)})}))},menu_command_click:function(e){switch(e.command){case"info":this.show_guest_info_click(e.guest);break;case"start":this.show_start_guest_click(e.guest);break;case"reboot":this.reboot_guest_click(e.guest);break;case"stop":this.show_stop_guest_click(e.guest);break;case"detach_cd":this.detach_guest_cd_room_click(e.guest);break;case"attach_cd":this.show_attach_cd_room_click(e.guest);break;case"vnc":this.vnc_click(e.guest);break;case"destroy":this.destroy_guest(e.guest);break}},show_guest_info_click:function(e){var t=this;return(0,x.Z)((0,I.Z)().mark((function s(){return(0,I.Z)().wrap((function(s){while(1)switch(s.prev=s.next){case 0:return t.show_guest_info.guestId=e.guestId,t.show_guest_info.current_guest=e,s.next=4,t.load_current_guest_template(e);case 4:return s.next=6,t.load_current_guest_host(e);case 6:return s.next=8,t.load_current_guest_scheme(e);case 8:return s.next=10,t.load_current_guest_volume(e);case 10:return s.next=12,t.load_current_guest_network(e);case 12:t.show_type=1;case 13:case"end":return s.stop()}}),s)})))()},show_reinstall_guest_click:function(e){var t=this;return(0,x.Z)((0,I.Z)().mark((function s(){return(0,I.Z)().wrap((function(s){while(1)switch(s.prev=s.next){case 0:t.load_all_attach_volumes(),t.load_all_template(),t.load_all_storage(),t.load_all_snapshot(),t.$refs["reInstallForm"]&&t.$refs["reInstallForm"].resetFields(),t.reinstall_guest.guestId=e.guestId,t.reinstall_guest.isoTemplateId="",t.reinstall_guest.diskTemplateId="",t.reinstall_guest.snapshotVolumeId="",t.reinstall_guest.volumeId="",t.reinstall_guest.type=0,t.show_type=3;case 12:case"end":return s.stop()}}),s)})))()},show_start_guest_click:function(e){var t=this;return(0,x.Z)((0,I.Z)().mark((function s(){return(0,I.Z)().wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,t.load_all_host();case 2:t.start_guest.guestId=e.guestId,t.start_guest.hostId=0,t.start_dialog_visiable=!0;case 5:case"end":return s.stop()}}),s)})))()},show_attach_network_click:function(e){var t=this;return(0,x.Z)((0,I.Z)().mark((function s(){return(0,I.Z)().wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,t.load_all_networks();case 2:t.attach_network_guest.guestId=e.guestId,t.attach_network_guest.networkId="",t.attach_network_dialog_visiable=!0;case 5:case"end":return s.stop()}}),s)})))()},show_attach_volume_click:function(e){var t=this;return(0,x.Z)((0,I.Z)().mark((function s(){return(0,I.Z)().wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,t.load_all_attach_volumes();case 2:t.attach_volume_guest.guestId=e.guestId,t.attach_volume_guest.volumeId="",t.attach_volume_dialog_visiable=!0;case 5:case"end":return s.stop()}}),s)})))()},show_stop_guest_click:function(e){this.stop_guest.guestId=e.guestId,this.stop_guest.force=!1,this.stop_dialog_visiable=!0},show_attach_cd_room_click:function(e){this.load_all_template(),this.attach_cd_room_guest.guestId=e.guestId,this.attach_cd_room_guest.templateId="",this.attach_cd_room_dialog_visiable=!0},show_modify_guest_click:function(e){this.load_all_schemes(),this.modify_guest.guestId=e.guestId,this.modify_guest.description=e.description,this.modify_guest.schemeId=e.schemeId,this.modify_guest.busType=e.busType,this.modify_guest_dialog_visiable=!0},vnc_click:function(e){var t=this.$router.resolve({path:"/Vnc",query:{id:e.guestId,description:e.description}}),s=t.href;window.open(s,"_blank")},destroy_guest:function(e){var t=this;this.$confirm("删除当前虚拟机, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Rt({guestId:e.guestId}).then((function(s){if(0===s.code){var o=t.guests.findIndex((function(t){return t.guestId===e.guestId}));o>=0&&t.guests.splice(o,1),t.show_type=0}else t.$notify.error({title:"错误",message:"删除虚拟机失败:".concat(s.message)})}))}))["catch"]((function(){}))},batch_start_guest_click:function(){var e=this;this.$confirm("启动所选虚拟机, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var t=e.select_guests.map((function(e){return e.guestId})).join(",");Wt({guestIds:t}).then((function(t){0===t.code?t.data.filter((function(t){e.update_guest_info(t)})):e.$notify.error({title:"错误",message:"批量启动虚拟机失败:".concat(t.message)})}))}))["catch"]((function(){}))},batch_stop_guest_click:function(){var e=this;this.$confirm("停止所选虚拟机, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var t=e.select_guests.map((function(e){return e.guestId})).join(",");Yt({guestIds:t}).then((function(t){0===t.code?t.data.filter((function(t){e.update_guest_info(t)})):e.$notify.error({title:"错误",message:"批量停止虚拟机失败:".concat(t.message)})}))}))["catch"]((function(){}))}}},we=ge;var ve=(0,u.Z)(we,me,fe,!1,null,"3f75a031",null);const ye=ve.exports;var be=function(){var e=this,t=e._self._c;return t("div",{staticClass:"main"},[t("div",{attrs:{id:"top_bar"}},[t("div",{attrs:{id:"status"}},[e._v(e._s(e.status))]),t("div",{attrs:{id:"sendCtrlAltDelButton"},on:{onclick:e.on_send_ctrl_alt_del}},[e._v("发送 Ctrl+Alt+Del")])]),t("div",{attrs:{id:"screen"}})])},ke=[],Ie=s(35417);const xe={name:"VncView",inject:["check_full_screen"],data:function(){return{id:0,description:"",rfb:null,url:"",status:"连接中..."}},mounted:function(){var e;this.check_full_screen(!0),this.id=this.$route.query.id,this.description=this.$route.query.description,e="https:"===window.location.protocol?"wss":"ws",this.status="正在连接[".concat(this.description,"]..."),this.url="".concat(e,"://").concat(window.location.host,"/api/vnc/").concat(this.id),this.connect()},beforeDestroy:function(){this.check_full_screen(!1)},methods:{connect:function(){var e=this;Lt({guestId:this.id}).then((function(t){0===t.code&&(e.rfb=new Ie.Z(document.getElementById("screen"),e.url,{credentials:{password:t.data}}),e.rfb.addEventListener("connect",e.on_connect_success),e.rfb.addEventListener("disconnect",e.on_disconnect),e.rfb.addEventListener("credentialsrequired",e.on_required_password),e.rfb.scaleViewport=!1,e.rfb.resizeSession=!1)}))},on_connect_success:function(){this.status="连接成功[".concat(this.description,"]")},on_disconnect:function(e){this.status="远程连接已断开[".concat(this.description,"]"),e.detail.clean&&(this.status="正在重新连接[".concat(this.description,"]..."),this.connect())},on_required_password:function(){var e=this;Lt({guestId:this.id}).then((function(t){0===t.code&&t.data&&e.rfb.sendCredentials({password:t.data})}))},on_send_ctrl_alt_del:function(){this.rfb.sendCtrlAltDel()}}},Te=xe;var Se=(0,u.Z)(Te,be,ke,!1,null,"01864a97",null);const $e=Se.exports;var Ce=function(){var e=this,t=e._self._c;return t("div",[t("el-container",[t("el-main",[t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("系统汇总")])]),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:4}},[t("div",[t("el-statistic",{attrs:{"group-separator":",",value:this.networks.length,title:"网络数量"}})],1)]),t("el-col",{attrs:{span:4}},[t("div",[t("el-statistic",{attrs:{"group-separator":",",value:this.storages.length,title:"存储池数量"}})],1)]),t("el-col",{attrs:{span:4}},[t("div",[t("el-statistic",{attrs:{"group-separator":",",value:this.hosts.length,title:"主机数量"}})],1)]),t("el-col",{attrs:{span:4}},[t("div",[t("el-statistic",{attrs:{"group-separator":",",value:this.guests.length,title:"虚拟机数量"}},[t("template",{slot:"formatter"},[e._v(e._s(e.get_runing_guest_number())+" /"+e._s(this.guests.length))])],2)],1)]),t("el-col",{attrs:{span:4}},[t("div",[t("el-statistic",{attrs:{"group-separator":",",value:this.volumes.length,title:"磁盘数量"}})],1)])],1),t("el-divider"),t("el-card",[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("主机信息")])]),t("div",{staticClass:"component"},[t("div",[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"已使用:"+e.get_allocat_cpu()+"核 / 总共:"+e.get_total_cpu()+"核",placement:"top"}},[t("el-progress",{attrs:{format:e.get_cpu_progress_title,type:"circle",percentage:e.totalCpuPercentage,color:"#67C23A"}})],1)],1),t("div",[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"已使用:"+e.get_memory_desplay(e.get_allocat_memory())+" / 总共:"+e.get_memory_desplay(e.get_total_memory()),placement:"top"}},[t("el-progress",{attrs:{format:e.get_memory_progress_title,type:"circle",percentage:e.totalMemoryePercentage,color:"#67C23A"}})],1)],1),t("div",[t("el-table",{attrs:{data:e.hosts}},[t("el-table-column",{attrs:{label:"名称",prop:"displayName"}}),t("el-table-column",{attrs:{label:"主机IP",prop:"hostIp",width:"200"}}),t("el-table-column",{attrs:{label:"CPU",prop:"hostIp","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(e){return[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"已使用:"+e.row.allocationCpu+"核 / 总共:"+e.row.totalCpu+"核",placement:"top"}},[t("el-progress",{attrs:{color:"#67C23A",percentage:parseInt(100*e.row.allocationCpu/e.row.totalCpu)}})],1)]}}])}),t("el-table-column",{attrs:{label:"内存",prop:"hostIp","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"已使用:"+e.get_memory_desplay(s.row.allocationMemory)+" / 总共:"+e.get_memory_desplay(s.row.totalMemory),placement:"top"}},[t("el-progress",{attrs:{color:"#67C23A",percentage:parseInt(100*s.row.allocationMemory/s.row.totalMemory)}})],1)]}}])}),t("el-table-column")],1)],1)])]),t("el-divider"),t("el-card",[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("存储池")])]),t("div",{staticClass:"storage_component"},[t("div",[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"已用:"+e.get_storage_desplay(e.get_allocat_storage())+" / 总共:"+e.get_storage_desplay(e.get_total_capacity()),placement:"top"}},[t("el-progress",{attrs:{type:"circle",format:e.get_storage_progress_title,percentage:e.totalStoragePercentage,color:"#67C23A"}})],1)],1),t("div",[t("el-table",{attrs:{data:e.storages}},[t("el-table-column",{attrs:{label:"名称",prop:"name",width:"120"}}),t("el-table-column",{attrs:{label:"类型",prop:"type",width:"120"}}),t("el-table-column",{attrs:{label:"容量",prop:"capacity",width:"180"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"已用:"+e.get_storage_desplay(s.row.allocation)+" / 总共:"+e.get_storage_desplay(s.row.capacity),placement:"top"}},[t("el-progress",{attrs:{color:"#67C23A",percentage:parseInt(100*s.row.allocation/s.row.capacity)}})],1)]}}])}),t("el-table-column")],1)],1)])])],1)],1)],1)],1)},ze=[];const qe={name:"guestView",components:{},data:function(){return{hosts:[],networks:[],storages:[],volumes:[],guests:[],totalStoragePercentage:0,totalCpuPercentage:0,totalMemoryePercentage:0}},mounted:function(){this.init_data()},methods:{init_data:function(){var e=this;at().then((function(t){0===t.code&&(e.hosts=t.data,e.totalCpuPercentage=Math.floor(100*e.get_allocat_cpu()/e.get_total_cpu()),e.totalMemoryePercentage=Math.floor(100*e.get_allocat_memory()/e.get_total_memory()))})),Qe().then((function(t){0===t.code&&(e.networks=t.data)})),ut().then((function(t){0===t.code&&(e.storages=t.data)})),St().then((function(t){0===t.code&&(e.volumes=t.data)})),jt().then((function(t){0===t.code&&(e.guests=t.data)})),ut().then((function(t){0===t.code&&(e.storages=t.data,e.totalStoragePercentage=parseInt(100*e.get_allocat_storage()/e.get_total_capacity()))}))},get_runing_guest_number:function(){return this.guests.filter((function(e){return 2===e.status})).length},get_storage_desplay:function(e){return e>1099511627776?(e/1099511627776).toFixed(2)+" TB":e>1073741824?(e/1073741824).toFixed(2)+" GB":e>1048576?(e/1048576).toFixed(2)+" MB":e>1024?(e/1024).toFixed(2)+"  KB":e+"  bytes"},get_memory_desplay:function(e){return e>1048576?(e/1048576).toFixed(2)+" GB":e>1024?(e/1024).toFixed(2)+"  MB":void 0},get_total_memory:function(){var e=0;return this.hosts.forEach((function(t){return e+=t.totalMemory})),e},get_allocat_memory:function(){var e=0;return this.hosts.forEach((function(t){return e+=t.allocationMemory})),e},get_total_cpu:function(){var e=0;return this.hosts.forEach((function(t){return e+=t.totalCpu})),e},get_allocat_cpu:function(){var e=0;return this.hosts.forEach((function(t){return e+=t.allocationCpu})),e},locat_cpu:function(){var e=0;return this.hosts.forEach((function(t){return e+=t.allocationCpu})),e},get_total_capacity:function(){var e=0;return this.storages.forEach((function(t){return e+=t.capacity})),e},get_allocat_storage:function(){var e=0;return this.storages.forEach((function(t){return e+=t.allocation})),e},get_cpu_progress_title:function(e){return"总内核:"+e+"%"},get_memory_progress_title:function(e){return"总内存:"+e+"%"},get_storage_progress_title:function(e){return"总存储:"+e+"%"}}},Ze=qe;var Be=(0,u.Z)(Ze,Ce,ze,!1,null,"f6e4a0a2",null);const Pe=Be.exports;var Fe=function(){var e=this,t=e._self._c;return t("div",[t("el-container",[t("el-main",[t("el-card",{directives:[{name:"show",rawName:"v-show",value:0===this.show_type,expression:"this.show_type === 0"}],staticClass:"box-card"},[t("el-row",{staticClass:"clearfix",staticStyle:{height:"20px"},attrs:{slot:"header"},slot:"header"},[t("el-button",{staticStyle:{float:"left",padding:"3px 0"},attrs:{type:"text"},on:{click:e.show_create_user_click}},[e._v("注册用户")])],1),t("el-row",[t("el-table",{staticStyle:{width:"100%"},attrs:{"v-loading":e.data_loading,data:e.users}},[t("el-table-column",{attrs:{label:"ID",prop:"userId",width:"80"}}),t("el-table-column",{attrs:{label:"用户名",prop:"loginName",width:"200"}}),t("el-table-column",{attrs:{label:"状态",prop:"state",width:"180"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{attrs:{type:0===s.row.state?"success":"danger"}},[e._v(e._s(0===s.row.state?"启用":"禁用"))])]}}])}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{type:"",size:"mini"},on:{click:function(t){return e.show_reset_password_click(s.row)}}},[e._v("重置密码")]),1===s.row.state?t("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(t){return e.update_user_state_click(s.row,0)}}},[e._v("启用")]):e._e(),0===s.row.state?t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.update_user_state_click(s.row,1)}}},[e._v("禁用")]):e._e(),t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.destroy_user_click(s.row)}}},[e._v("删除")])]}}])})],1)],1)],1),t("el-card",{directives:[{name:"show",rawName:"v-show",value:1===this.show_type,expression:"this.show_type === 1"}],staticClass:"box-card"},[t("el-row",{attrs:{slot:"header"},slot:"header"},[t("el-page-header",{staticStyle:{color:"#409eff"},attrs:{content:"注册用户"},on:{back:function(t){return e.show_user_list()}}})],1),t("el-row",[t("el-form",{ref:"createForm",staticClass:"demo-ruleForm",attrs:{model:e.create_user,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"登录名",prop:"loginName"}},[t("el-input",{model:{value:e.create_user.loginName,callback:function(t){e.$set(e.create_user,"loginName",t)},expression:"create_user.loginName"}})],1),t("el-form-item",{attrs:{label:"密码",prop:"password"}},[t("el-input",{attrs:{"show-password":""},model:{value:e.create_user.password,callback:function(t){e.$set(e.create_user,"password",t)},expression:"create_user.password"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.on_create_user_click}},[e._v("注册")]),t("el-button",{on:{click:e.show_user_list}},[e._v("取消")])],1)],1)],1)],1),t("el-dialog",{attrs:{title:"重置密码",visible:e.reset_passwor_dialog_visiable,width:"300px"},on:{"update:visible":function(t){e.reset_passwor_dialog_visiable=t}}},[t("el-form",{ref:"resetPasswordForm",attrs:{model:e.reset_password_user,"label-width":"60px"}},[t("el-form-item",{attrs:{label:"密码"}},[t("el-input",{attrs:{placeholder:"请输入密码","show-password":""},model:{value:e.reset_password_user.password,callback:function(t){e.$set(e.reset_password_user,"password",t)},expression:"reset_password_user.password"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.reset_passwor_dialog_visiable=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.on_reset_password_click}},[e._v("确 定")])],1)],1)],1)],1)],1)},Ne=[];const Ve={name:"userView",components:{},data:function(){return{data_loading:!1,current_loading:!1,reset_passwor_dialog_visiable:!1,show_type:0,create_user:{loginName:"",password:""},reset_password_user:{userId:0,password:""},users:[]}},mounted:function(){this.init_view(),this.show_type=0},methods:{init_view:function(){var e=this;return(0,x.Z)((0,I.Z)().mark((function t(){return(0,I.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.data_loading=!0,t.next=3,us().then((function(t){0==t.code&&(e.users=t.data)}))["finally"]((function(){e.data_loading=!1}));case 3:case"end":return t.stop()}}),t)})))()},show_user_list:function(){this.show_type=0},show_create_user_click:function(){this.$refs["createForm"]&&this.$refs["createForm"].resetFields(),this.show_type=1},show_reset_password_click:function(e){this.$refs["resetPasswordForm"]&&this.$refs["resetPasswordForm"].resetFields(),this.reset_password_user.userId=e.userId,this.reset_password_user.password="",this.reset_passwor_dialog_visiable=!0},update_user_info:function(e){var t=this.users.findIndex((function(t){return t.userId===e.userId}));t>=0?this.$set(this.users,t,e):this.users.push(e),this.show_user&&this.show_user.userId===e.userId&&(this.show_user=e)},on_create_user_click:function(){var e=this;ds(this.create_user).then((function(t){0===t.code?(e.update_user_info(t.data),e.show_type=0):e.$notify.error({title:"错误",message:"注册用户失败:".concat(t.message)})}))},on_reset_password_click:function(){var e=this;this.$confirm("重置密码, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){ps(e.reset_password_user).then((function(t){0===t.code?(e.update_user_info(t.data),e.reset_passwor_dialog_visiable=!1):e.$notify.error({title:"错误",message:"重置密码失败:".concat(t.message)})}))}))["catch"]((function(){}))},update_user_state_click:function(e,t){var s=this,o=0===t?"启用用户":"禁用用户";this.$confirm("".concat(o,", 是否继续?"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){_s({userId:e.userId,state:t}).then((function(e){0===e.code?s.update_user_info(e.data):s.$notify.error({title:"错误",message:"".concat(o,"失败:").concat(e.message)})}))}))["catch"]((function(){}))},destroy_user_click:function(e){var t=this;this.$confirm("删除用户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){ms({userId:e.userId}).then((function(s){if(0===s.code){var o=t.users.findIndex((function(t){return t.userId===e.userId}));o>=0&&t.users.splice(o,1)}else t.$notify.error({title:"错误",message:"删除用户失败:".concat(s.message)})}))}))["catch"]((function(){}))}}},Oe=Ve;var De=(0,u.Z)(Oe,Fe,Ne,!1,null,"3724222a",null);const Ee=De.exports;var Me=function(){var e=this,t=e._self._c;return t("div",{staticClass:"login-container",attrs:{id:"main"}},["Login"!==e.show_type||this.oauth.enalbe?e._e():t("el-form",{ref:"ruleForm2",staticClass:"demo-ruleForm login-page",attrs:{"label-position":"left","label-width":"0px","status-icon":""}},[t("h3",{staticClass:"title"},[e._v("KVM Cloud Login")]),t("el-form-item",{attrs:{prop:"username"}},[t("el-input",{attrs:{"auto-complete":"off",autofocus:"true",placeholder:"用户名","prefix-icon":"el-icon-s-custom",type:"text"},model:{value:e.loginData.loginName,callback:function(t){e.$set(e.loginData,"loginName",t)},expression:"loginData.loginName"}})],1),t("el-form-item",{attrs:{prop:"password"}},[t("el-input",{attrs:{"show-password":!0,"auto-complete":"off",placeholder:"密码","prefix-icon":"el-icon-lock",type:"password"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.login.apply(null,arguments)}},model:{value:e.loginData.password,callback:function(t){e.$set(e.loginData,"password",t)},expression:"loginData.password"}})],1),t("el-form-item",{staticStyle:{width:"100%"}},[t("el-button",{staticStyle:{width:"100%"},attrs:{disabled:""==e.loginData.loginName||""==e.loginData.password,loading:e.loading,type:"primary"},on:{click:e.login}},[e._v("登录")])],1)],1),"Loading"===e.show_type?t("el-form",{staticClass:"login-page",attrs:{"label-position":"left","label-width":"0px","status-icon":""}},[t("div",{staticClass:"title"},[e._v(e._s(this.oauth.title))]),t("div",{directives:[{name:"loading",rawName:"v-loading",value:!0,expression:"true"}],staticStyle:{height:"80px","font-size":"30px","margin-bottom":"10px"},attrs:{"element-loading-spinner":"el-icon-loading","element-loading-text":"正在登录,请稍后..."}})]):e._e(),"Error"===e.show_type?t("el-form",{staticClass:"login-page",attrs:{"label-position":"left","label-width":"0px","status-icon":""}},[t("div",{staticClass:"title"},[e._v(e._s(this.oauth.title))]),t("div",[t("strong",{staticStyle:{color:"red"}},[e._v(e._s(this.errorMessage))])]),t("div",{staticClass:"register"},[t("el-link",{attrs:{type:"primary"},on:{click:function(t){return e.go_login()}}},[e._v("重新登录")])],1)]):e._e()],1)},Le=[];const Ue={name:"loginView",inject:["check_full_screen"],data:function(){return{loginData:{loginName:"",password:""},oauth:{enable:!1,title:" Oauth2 登录"},show_type:"",errorMessage:"",loading:!1}},mounted:function(){var e=this;this.check_full_screen(!0),ws().then((function(t){if(0===t.code)if(t.data.oauth&&(e.oauth.title=t.data.oauth.title,e.oauth.enable=t.data.oauth.enable),e.oauth.enable){var s=e.$route.query.code;s&&""!==s?is({code:s}).then((function(t){0!==t.code?(e.errorMessage="登录失败,服务器返回如下:\r\n".concat(t.message),e.show_type="Error"):(localStorage.setItem("X-Token",t.data.token),e.$router.push({path:"/"}))})):e.go_login()}else e.show_type="Login";else e.show_type="Login"}))},beforeDestroy:function(){this.check_full_screen(!1)},methods:{login:function(){var e=this;this.loading=!0,console.log(this.loginData.loginName),fs({loginName:this.loginData.loginName}).then((function(t){if(0===t.code){var s=window.sha256_digest(window.sha256_digest(e.loginData.password+":"+t.data.signature)+":"+t.data.nonce);cs({loginName:e.loginData.loginName,password:s,nonce:t.data.nonce}).then((function(t){0===t.code?(localStorage.setItem("X-Token",t.data.token),e.$router.push({path:"/"})):e.$notify.error({title:"错误",duration:3e3,message:"登录失败:".concat(t.message)})}))["finally"]((function(){e.loading=!1}))}else e.$notify.error({title:"错误",duration:3e3,message:"登录失败:".concat(t.message)})}))["finally"]((function(){e.loading=!1}))},go_login:function(){window.location.href="/login"},show_login:function(){this.show_type="Login"}}},Ge=Ue;var je=(0,u.Z)(Ge,Me,Le,!1,null,"6542b460",null);const Ae=je.exports;o["default"].use(y.ZP);var He=[{path:"/",name:"Home",component:Pe},{path:"/Vnc",name:"Vnc",component:$e},{path:"/Guest",name:"Guest",component:ye},{path:"/Network",name:"Network",component:B},{path:"/Host",name:"Host",component:D},{path:"/Storage",name:"Storage",component:j},{path:"/Template",name:"Template",component:J},{path:"/Snapshot",name:"Snapshot",component:se},{path:"/Volume",name:"Volume",component:ie},{path:"/Scheme",name:"Scheme",component:he},{path:"/User",name:"User",component:Ee},{path:"/Login",name:"Login",component:Ae}],Re=new y.ZP({routes:He});const Ke=Re;var Xe=s(67986),Je=function(){function e(){(0,m.Z)(this,e),this.baseUrl=""}return(0,f.Z)(e,[{key:"getInsideConfig",value:function(){var e={baseURL:Xe.BASEURL,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-Token":localStorage.getItem("X-Token")}};return e}},{key:"destroy",value:function(e){delete this.queue[e]}},{key:"interceptors",value:function(e,t){var s=this;e.interceptors.request.use((function(e){return"get"!==e.method.toLowerCase()?e.data=v().stringify(e.data):e.data=!0,e}),(function(e){return Promise.reject(e)})),e.interceptors.response.use((function(e){var t=e.data;if(401!==t.code)return e.data;Ke.push({path:"/login"})}),(function(e){s.destroy(t);var o=e.response;if(o){var a=o.status,r=null;switch(a){case 400:r="请求参数错误";break;case 401:r="未授权或token过期，请登录";break;case 413:r="资源大小超过限制";break;case 403:r="跨域访问已被拒绝";break;case 404:r="请求地址出错: ".concat(o.config.url);break;case 408:r="请求超时";break;case 405:r="请求方法不正确";break;case 500:r="服务器内部错误";break;case 501:r="服务器未实现";break;case 502:r="网关错误";break;case 503:r="该服务不可用";break;case 504:r="网关超时";break;case 505:r="HTTP版本不受支持";break;default:r="未知错误status:".concat(a)}return console.log(r),Promise.reject(e)}return Promise.reject(e)}))}},{key:"request",value:function(e){var t=g.Z.create(),s=Object.assign({},e,this.getInsideConfig());return this.interceptors(t,s.url),t(s)}}]),e}();const We=new Je;var Qe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"/api/network/all",params:e})},Ye=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"/api/network/info",params:e})},et=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/network/create",data:e,method:"PUT"})},tt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/network/maintenance",data:e,method:"POST"})},st=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"/api/network/register",data:e,method:"POST"})},ot=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/network/destroy",data:e,method:"DELETE"})},at=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"/api/host/all",params:e})},rt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"/api/host/info",params:e})},nt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/host/create",data:e,method:"PUT"})},lt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/host/maintenance",data:e,method:"POST"})},it=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"/api/host/register",data:e,method:"POST"})},ct=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/host/destroy",data:e,method:"DELETE"})},ut=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"/api/storage/all",params:e})},dt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"/api/storage/info",params:e})},_t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/storage/create",data:e,method:"PUT"})},pt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/storage/maintenance",data:e,method:"POST"})},ht=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"/api/storage/register",data:e,method:"POST"})},mt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/storage/destroy",data:e,method:"DELETE"})},ft=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"/api/template/all",params:e})},gt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"/api/template/info",params:e})},wt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/template/create",data:e,method:"PUT"})},vt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/template/volume/create",data:e,method:"PUT"})},yt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/template/download",data:e,method:"POST"})},bt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/template/destroy",data:e,method:"DELETE"})},kt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"/api/snapshot/all",params:e})},It=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"/api/snapshot/info",params:e})},xt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/snapshot/create",data:e,method:"PUT"})},Tt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/snapshot/destroy",data:e,method:"DELETE"})},St=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"/api/volume/all",params:e})},$t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"/api/volume/not/attach/all",params:e})},Ct=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"/api/volume/info",params:e})},zt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/volume/create",data:e,method:"PUT"})},qt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/volume/migrate",data:e,method:"PUT"})},Zt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/volume/resize",data:e,method:"POST"})},Bt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/volume/clone",data:e,method:"PUT"})},Pt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/volume/destroy",data:e,method:"DELETE"})},Ft=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/volume/destroy/batch",data:e,method:"DELETE"})},Nt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"/api/scheme/all",params:e})},Vt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"/api/scheme/info",params:e})},Ot=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/scheme/create",data:e,method:"PUT"})},Dt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/scheme/modify",data:e,method:"POST"})},Et=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/scheme/destroy",data:e,method:"DELETE"})},Mt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"/api/guest/info",params:e})},Lt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"/api/guest/vnc/password",params:e})},Ut=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"/api/guest/volume",params:e})},Gt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"/api/guest/network",params:e})},jt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"/api/guest/all",params:e})},At=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"/api/guest/system",params:e})},Ht=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"/api/guest/user",params:e})},Rt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/guest/destroy",data:e,method:"DELETE"})},Kt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/guest/create",data:e,method:"PUT"})},Xt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/guest/reinstall",data:e,method:"POST"})},Jt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/guest/start",data:e,method:"POST"})},Wt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/guest/start/batch",data:e,method:"POST"})},Qt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/guest/shutdown",data:e,method:"POST"})},Yt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/guest/shutdown/batch",data:e,method:"POST"})},es=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/guest/reboot",data:e,method:"POST"})},ts=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/guest/modify",data:e,method:"POST"})},ss=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/guest/cd/attach",data:e,method:"POST"})},os=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/guest/cd/detach",data:e,method:"POST"})},as=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/guest/disk/attach",data:e,method:"POST"})},rs=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/guest/disk/detach",data:e,method:"POST"})},ns=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/guest/network/attach",data:e,method:"POST"})},ls=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/guest/network/detach",data:e,method:"POST"})},is=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/user/oauth2/login",data:e,method:"POST"})},cs=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"/api/user/login",data:e,method:"POST"})},us=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/user/list",data:e,method:"GET"})},ds=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/user/register",data:e,method:"PUT"})},_s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/user/state/update",data:e,method:"POST"})},ps=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/user/password/reset",data:e,method:"POST"})},hs=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/user/password/modify",data:e,method:"POST"})},ms=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/user/destroy",data:e,method:"DELETE"})},fs=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/user/login/signature",params:e})},gs=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/user/signature",params:e})},ws=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return We.request({url:"api/config",data:e,method:"GET"})};const vs={data:function(){return{update_password_dialog_visible:!1,update_password:{oldPassword:"",newPassword:"",confirmPassword:"",nonce:""}}},methods:{handleSelect:function(e){var t=this;switch(e){case"password":this.update_password.oldPassword="",this.update_password.newPassword="",this.update_password.confirmPassword="",this.update_password.nonce="",this.update_password_dialog_visible=!0;break;case"quit":this.$confirm("退出登录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){localStorage.removeItem("X-Token"),t.$router.push({path:"/Login"})}))["catch"]((function(){}));break}},update_user_password_click:function(){var e=this;this.update_password.newPassword==this.update_password.confirmPassword?gs().then((function(t){if(0===t.code){var s=window.sha256_digest(window.sha256_digest(e.update_password.oldPassword+":"+t.data.signature)+":"+t.data.nonce),o=t.data.nonce,a=window.sha256_digest(e.newPassword+":"+t.data.signature),r={oldPassword:s,newPassword:a,nonce:o};hs(r).then((function(t){0!==t.code?e.$notify.error({title:"错误",message:"修改密码失败:".concat(t.message)}):e.update_password_dialog_visible=!1}))}else e.$notify.error({title:"错误",message:"修改密码失败:".concat(t.message)})})):this.$notify.error({title:"错误",duration:3e3,message:"新密码与旧密码不一致"})}}},ys=vs;var bs=(0,u.Z)(ys,p,h,!1,null,"08998a84",null);const ks=bs.exports,Is={components:{NavViewVue:_,HeadViewVue:ks},provide:function(){var e=this;return{check_full_screen:function(t){e.isFullScreen=t}}},data:function(){return{isFullScreen:!1}}},xs=Is;var Ts=(0,u.Z)(xs,a,r,!1,null,null,null);const Ss=Ts.exports;var $s=s(90408);o["default"].use($s.ZP);const Cs=new $s.ZP.Store({state:{},getters:{},mutations:{},actions:{},modules:{}});var zs=s(85114),qs=s.n(zs);o["default"].use(qs()),o["default"].config.productionTip=!1,o["default"].prototype.$websocket=void 0,new o["default"]({router:Ke,store:Cs,render:function(e){return e(Ss)}}).$mount("#app")},66949:(e,t,s)=>{"use strict";e.exports=s.p+"img/logo.047618b0.png"},24654:()=>{}},t={};function s(o){var a=t[o];if(void 0!==a)return a.exports;var r=t[o]={id:o,loaded:!1,exports:{}};return e[o].call(r.exports,r,r.exports,s),r.loaded=!0,r.exports}s.m=e,(()=>{s.amdO={}})(),(()=>{var e=[];s.O=(t,o,a,r)=>{if(!o){var n=1/0;for(u=0;u<e.length;u++){for(var[o,a,r]=e[u],l=!0,i=0;i<o.length;i++)(!1&r||n>=r)&&Object.keys(s.O).every((e=>s.O[e](o[i])))?o.splice(i--,1):(l=!1,r<n&&(n=r));if(l){e.splice(u--,1);var c=a();void 0!==c&&(t=c)}}return t}r=r||0;for(var u=e.length;u>0&&e[u-1][2]>r;u--)e[u]=e[u-1];e[u]=[o,a,r]}})(),(()=>{s.n=e=>{var t=e&&e.__esModule?()=>e["default"]:()=>e;return s.d(t,{a:t}),t}})(),(()=>{s.d=(e,t)=>{for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}})(),(()=>{s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{s.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{s.nmd=e=>(e.paths=[],e.children||(e.children=[]),e)})(),(()=>{s.p="/"})(),(()=>{var e={143:0};s.O.j=t=>0===e[t];var t=(t,o)=>{var a,r,[n,l,i]=o,c=0;if(n.some((t=>0!==e[t]))){for(a in l)s.o(l,a)&&(s.m[a]=l[a]);if(i)var u=i(s)}for(t&&t(o);c<n.length;c++)r=n[c],s.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return s.O(u)},o=self["webpackChunkcloud"]=self["webpackChunkcloud"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var o=s.O(void 0,[998],(()=>s(97080)));o=s.O(o)})();