"use strict";(self["webpackChunkkvm_cloud_web"]=self["webpackChunkkvm_cloud_web"]||[]).push([[347],{2624:function(e,a,l){l.r(a),l.d(a,{default:function(){return V}});var t=l(6845),n=(l(4974),l(8206),l(9464)),o=(l(2708),l(6390)),i=(l(8145),l(1177),l(5143)),u=(l(493),l(7836)),c=(l(3020),l(9622),l(7255)),r=(l(756),l(5567),l(6918)),s=l(1654),d=l(4673),b=l(5077),m=l(2303),p=l(7898),f=(l(7191),l(1421)),h=l(8180),v=l(7445);const _={class:"dialog-footer"};var k={__name:"EditSshDialog",emits:["on-create-ssh","on-update-ssh"],setup(e,{expose:a,emit:l}){const t=(0,s.KR)(!1),{t:n}=(0,v.s9)(),o=l,m=(0,s.Kh)({id:"",name:""}),k=(0,s.KR)(""),g=(0,s.Kh)({name:[{required:!0,message:n("cj.tooltip.global.not_empty",{name:n("cj.label.basic.name")}),trigger:["blur","change"]},{min:1,max:32,message:n("cj.tooltip.global.length_error",{name:n("cj.label.basic.name")}),trigger:["blur","change"]}]}),y=(0,s.KR)(null);function R(){y.value.validate((e=>{if(e){let e=m.id?"on-update-ssh":"on-create-ssh",a=m.id?b.Mw:b.t0,l=m.id?{id:m.id,name:m.name}:{name:m.name};a(l).then((a=>{0===a.code?(t.value=!1,o(e,a.data,!0),(0,f.z)(a)):(0,f.U)(a)}))}else(0,h.nk)({type:"error",message:n("cj.tooltip.global.has_error")})}))}return a({open:e=>{k.value=e.title,m.id=e.id,m.name=e.name,t.value=!0}}),(e,a)=>{const l=c.WK,n=i.xE,o=i.US,b=u.S2,f=p.kZ;return(0,r.uX)(),(0,r.Wv)(f,{modelValue:(0,s.R1)(t),"onUpdate:modelValue":a[2]||(a[2]=e=>(0,s.i9)(t)?t.value=e:null),title:(0,s.R1)(k),width:"400","close-on-click-modal":!1},{footer:(0,r.k6)((()=>[(0,r.Lk)("div",_,[(0,r.bF)(b,{onClick:a[1]||(a[1]=e=>t.value=!1)},{default:(0,r.k6)((()=>[(0,r.eW)((0,d.v_)(e.$t("cj.btn.basic.cancel")),1)])),_:1}),(0,r.bF)(b,{type:"primary",onClick:R},{default:(0,r.k6)((()=>[(0,r.eW)((0,d.v_)(e.$t("cj.btn.basic.confirm")),1)])),_:1})])])),default:(0,r.k6)((()=>[(0,r.bF)(o,{model:(0,s.R1)(m),"label-width":"auto",ref_key:"ssh_ref",ref:y,rules:(0,s.R1)(g)},{default:(0,r.k6)((()=>[(0,r.bF)(n,{label:e.$t("cj.label.basic.name"),prop:"name"},{default:(0,r.k6)((()=>[(0,r.bF)(l,{modelValue:(0,s.R1)(m).name,"onUpdate:modelValue":a[0]||(a[0]=e=>(0,s.R1)(m).name=e)},null,8,["modelValue"])])),_:1},8,["label"])])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])}}};const g=k;var y=g;function R(e,a,l,t){const n=(0,r.WQ)("websocket");(0,r.sV)((()=>{n.subscribe_notify(e,(e=>{if(13===e.type){let a=e.data;0==a.code?l(a.data):12000001==a.code&&t(e.id)}})),n.subscribe_connect_notify(e,(()=>{a()})),n.init(),a()})),(0,r.xo)((()=>{n.unsubscribe_notify(e),n.unsubscribe_connect_notify(e)}))}l(6447);const j={class:"dialog-footer"};var w={__name:"ImportEditSshDialog",emits:["on-create-ssh"],setup(e,{expose:a,emit:l}){const t=(0,s.KR)(!1),n=l,o=(0,s.Kh)({name:"",publicKey:"",privateKey:""}),{t:m}=(0,v.s9)(),_=(0,s.KR)(null),k=(0,s.Kh)({name:[{required:!0,message:m("cj.tooltip.global.not_empty",{name:m("cj.label.basic.name")}),trigger:["blur","change"]},{min:1,max:32,message:m("cj.tooltip.global.length_error",{name:m("cj.label.basic.name")}),trigger:["blur","change"]}],publicKey:[{required:!0,message:m("cj.tooltip.global.not_empty",{name:m("cj.label.ssh.publicKey")}),trigger:["blur","change"]}],privateKey:[{required:!0,message:m("cj.tooltip.global.not_empty",{name:m("cj.label.ssh.privateKey")}),trigger:["blur","change"]}]});function g(){_.value.validate((e=>{if(e){t.value=!1;let e="on-create-ssh",a=b.w_,l={name:o.name};a(l).then((a=>{0===a.code?(n(e,a.data,!0),(0,f.z)(a)):(0,f.U)(a)}))}else(0,h.nk)({type:"error",message:m("cj.tooltip.global.has_error")})}))}return a({open:()=>{t.value=!0}}),(e,a)=>{const l=c.WK,n=i.xE,b=i.US,m=u.S2,f=p.kZ;return(0,r.uX)(),(0,r.Wv)(f,{modelValue:(0,s.R1)(t),"onUpdate:modelValue":a[4]||(a[4]=e=>(0,s.i9)(t)?t.value=e:null),title:e.$t("cj.dialog.ssh.import"),width:"400","close-on-click-modal":!1},{footer:(0,r.k6)((()=>[(0,r.Lk)("div",j,[(0,r.bF)(m,{onClick:a[3]||(a[3]=e=>t.value=!1)},{default:(0,r.k6)((()=>[(0,r.eW)((0,d.v_)(e.$t("cj.btn.basic.cancel")),1)])),_:1}),(0,r.bF)(m,{type:"primary",onClick:g},{default:(0,r.k6)((()=>[(0,r.eW)((0,d.v_)(e.$t("cj.btn.basic.confirm")),1)])),_:1})])])),default:(0,r.k6)((()=>[(0,r.bF)(b,{model:(0,s.R1)(o),"label-width":"auto",ref_key:"ssh_ref",ref:_,rules:(0,s.R1)(k)},{default:(0,r.k6)((()=>[(0,r.bF)(n,{label:e.$t("cj.label.basic.name"),prop:"name"},{default:(0,r.k6)((()=>[(0,r.bF)(l,{modelValue:(0,s.R1)(o).name,"onUpdate:modelValue":a[0]||(a[0]=e=>(0,s.R1)(o).name=e)},null,8,["modelValue"])])),_:1},8,["label"]),(0,r.bF)(n,{label:e.$t("cj.label.ssh.publicKey"),prop:"publicKey"},{default:(0,r.k6)((()=>[(0,r.bF)(l,{modelValue:(0,s.R1)(o).publicKey,"onUpdate:modelValue":a[1]||(a[1]=e=>(0,s.R1)(o).publicKey=e),type:"textarea",rows:5},null,8,["modelValue"])])),_:1},8,["label"]),(0,r.bF)(n,{label:e.$t("cj.label.ssh.privateKey"),prop:"privateKey"},{default:(0,r.k6)((()=>[(0,r.bF)(l,{modelValue:(0,s.R1)(o).privateKey,"onUpdate:modelValue":a[2]||(a[2]=e=>(0,s.R1)(o).privateKey=e),type:"textarea",rows:5},null,8,["modelValue"])])),_:1},8,["label"])])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])}}};const K=w;var F=K,W=l(7774),$=(l(5280),Object.assign({name:"Ssh"},{__name:"Ssh",setup(e){const a=(0,s.KR)(null),l=(0,s.KR)(null),{t:p}=(0,v.s9)(),h=(0,s.KR)({keyword:"",no:1,size:10}),_=(0,s.KR)(!1),k=(0,s.KR)({data:[],total:0});function g(e){h.value.no=e,w()}function j(e){h.value.size=e,w()}function w(){_.value=!0,(0,b.r5)(h.value).then((e=>{const{list:a=[],total:l=0}=e.data||{};k.value={data:a,total:l}})).catch((()=>{k.value={data:[],total:0}})).finally((()=>{_.value=!1}))}function K(){const e={id:0,title:p("cj.dialog.ssh.create"),name:""};a.value.open(e)}function $(){l.value.open()}function C(e,l){const t={id:l.id,title:p("cj.dialog.ssh.edit"),name:l.name};a.value.open(t)}function V(e,a){(0,b.cd)({id:a.id}).then((e=>{if(0===e.code){let a=`//${window.location.host}/api/ssh/download?token=${e.data}`;window.open(a,"_blank")}else(0,f.U)(e)}))}function U(e,a=!1){let l=k.value.data.findIndex((a=>a.id===e.id));-1!==l?Object.assign(k.value.data[l],e):a&&(k.value.data.push(e),k.value.total++)}function x(e){let a=k.value.data.findIndex((a=>a.id===e));-1!==a&&(k.value.data.splice(a,1),k.value.total--)}function z(e,a){W.s.confirm(p("cj.dialog.ssh.deleteConfirm"),"Warning",{confirmButtonText:p("cj.btn.basic.confirm"),cancelButtonText:p("cj.btn.basic.cancel"),type:"warning"}).then((()=>{(0,b.Up)({id:a.id}).then((e=>{0===e.code?(x(a.id),(0,f.z)(e)):(0,f.U)(e)}))}))}return R("ssh_list",w,U,x),(e,b)=>{const p=c.WK,f=i.xE,v=u.S2,R=i.US,W=o.o8,x=o.Up,S=n.aQ,A=(0,r.gN)("Admin"),X=t.L;return(0,r.uX)(),(0,r.CE)("div",null,[(0,r.bF)(R,{model:(0,s.R1)(h),inline:"",size:"small"},{default:(0,r.k6)((()=>[(0,r.bF)(f,{label:e.$t("cj.label.basic.keyword")},{default:(0,r.k6)((()=>[(0,r.bF)(p,{modelValue:(0,s.R1)(h).keyword,"onUpdate:modelValue":b[0]||(b[0]=e=>(0,s.R1)(h).keyword=e)},null,8,["modelValue"])])),_:1},8,["label"]),(0,r.bF)(f,null,{default:(0,r.k6)((()=>[(0,r.bF)(v,{type:"primary",onClick:w,icon:(0,s.R1)(m.Search)},{default:(0,r.k6)((()=>[(0,r.eW)((0,d.v_)(e.$t("cj.btn.basic.search")),1)])),_:1},8,["icon"]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(v,{type:"primary",onClick:K,icon:(0,s.R1)(m.DocumentAdd)},{default:(0,r.k6)((()=>[(0,r.eW)((0,d.v_)(e.$t("cj.btn.basic.create")),1)])),_:1},8,["icon"])),[[A]]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(v,{type:"primary",onClick:$,icon:(0,s.R1)(m.Upload)},{default:(0,r.k6)((()=>[(0,r.eW)((0,d.v_)(e.$t("cj.btn.ssh.import")),1)])),_:1},8,["icon"])),[[A]])])),_:1})])),_:1},8,["model"]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(x,{data:(0,s.R1)(k).data,style:{width:"100%"},"table-layout":"auto",border:""},{default:(0,r.k6)((()=>[(0,r.bF)(W,{prop:"id",label:e.$t("cj.label.basic.id")},null,8,["label"]),(0,r.bF)(W,{prop:"name",label:e.$t("cj.label.basic.name")},null,8,["label"]),(0,r.bF)(W,{label:e.$t("cj.label.basic.operation")},{default:(0,r.k6)((a=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(v,{size:"small",type:"primary",onClick:e=>V(a.$index,a.row),icon:(0,s.R1)(m.Download)},{default:(0,r.k6)((()=>[(0,r.eW)((0,d.v_)(e.$t("cj.btn.ssh.download")),1)])),_:2},1032,["onClick","icon"])),[[A]]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(v,{size:"small",type:"primary",onClick:e=>C(a.$index,a.row),icon:(0,s.R1)(m.Edit)},{default:(0,r.k6)((()=>[(0,r.eW)((0,d.v_)(e.$t("cj.btn.basic.edit")),1)])),_:2},1032,["onClick","icon"])),[[A]]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(v,{size:"small",type:"danger",onClick:e=>z(a.$index,a.row),icon:(0,s.R1)(m.Delete)},{default:(0,r.k6)((()=>[(0,r.eW)((0,d.v_)(e.$t("cj.btn.basic.delete")),1)])),_:2},1032,["onClick","icon"])),[[A]])])),_:1},8,["label"])])),_:1},8,["data"])),[[X,(0,s.R1)(_)]]),b[3]||(b[3]=(0,r.Lk)("br",null,null,-1)),(0,r.bF)(S,{size:"small",background:"",onCurrentChange:g,onSizeChange:j,"current-page":(0,s.R1)(h).no,"onUpdate:currentPage":b[1]||(b[1]=e=>(0,s.R1)(h).no=e),"page-sizes":[10,20,50,100,200],"page-size":(0,s.R1)(h).size,"onUpdate:pageSize":b[2]||(b[2]=e=>(0,s.R1)(h).size=e),layout:"sizes, prev, pager, next, jumper, total",total:(0,s.R1)(k).total},null,8,["current-page","page-size","total"]),(0,r.bF)(y,{ref_key:"editSshDialogRef",ref:a,onOnCreateSsh:U,onOnUpdateSsh:U},null,512),(0,r.bF)(F,{ref_key:"importEditSshDialogRef",ref:l,onOnCreateSsh:U},null,512)])}}}));const C=$;var V=C},5077:function(e,a,l){l.d(a,{Mw:function(){return c},Up:function(){return r},W1:function(){return n},cd:function(){return s},r5:function(){return o},t0:function(){return i},w_:function(){return u}});var t=l(3162);const n=(e={})=>(0,t.A)({url:"api/ssh/all",params:e}),o=(e={})=>(0,t.A)({url:"api/ssh/search",params:e}),i=(e={})=>(0,t.A)({url:"api/ssh/create",params:e,method:"put"}),u=(e={})=>(0,t.A)({url:"api/ssh/create",params:e,method:"put"}),c=(e={})=>(0,t.A)({url:"api/ssh/modify",params:e,method:"post"}),r=(e={})=>(0,t.A)({url:"api/ssh/destroy",params:e,method:"delete"}),s=(e={})=>(0,t.A)({url:"/api/ssh/download/key",params:e,method:"post"})}}]);