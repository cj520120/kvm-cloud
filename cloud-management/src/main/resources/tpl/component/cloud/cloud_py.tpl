import websocket
import hashlib
import time
import json

managerUri='{{__SYS__["default.cluster.manager.uri"]}}'
networkScrect:str='{{secret}}'
networkId:str='{{networkId}}'
componentId:str='{{componentId}}'

def md5(data):
    md5 = hashlib.md5()
    md5.update(data.encode('utf-8'))
    return md5.hexdigest()

def on_message(ws, message):
    data=json.loads(message) 
    if data['command']==201:
        ws.send('{"command":205}')
        ws.send('{"command":206}')
    elif data['command']==203:
        if data['data']['type']==101:
            dns_body:str = ''
            for dns in data['data']['data']:
                dns_body += '{0} {1}\n'.format(dns['ip'],dns['domain'])
            dns_body = dns_body.strip()
            with open('/etc/dnsmasq.hosts.d/hosts','w+') as f:
                f.write(dns_body)


def on_error(ws, error):
    print(error)

def on_close(ws,a,b):
    print("WebSocket连接已关闭")

def on_open(ws):
    print("WebSocket连接已打开")  
    send_ws_login(ws)

def send_ws_login(ws):
    nonce = str(int(round(time.time() * 1000)))
    sign = md5('{0}:{1}:{2}:{3}'.format(networkScrect, networkId, componentId,nonce))
    send_msg={
        'command':200,
        'data':{
            'nonce':nonce,
            'sign':sign,
            'networkId':networkId,
            'componentId':componentId
        }
    }
    body=json.dumps(send_msg)
    ws.send(body)

 

if __name__ == "__main__": 
    while True: 
        ws_url=managerUri.replace('http', 'ws', 1)+'/api/component/ws'
        ws = websocket.WebSocketApp(ws_url,
                                on_message=on_message,
                                on_error=on_error,
                                on_close=on_close)
        ws.on_open = on_open
        ws.run_forever() 
        time.sleep(1) 