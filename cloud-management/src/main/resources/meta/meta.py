# pip3 install flask
from flask import Flask, request, make_response
import requests
import hashlib
app = Flask(__name__)

MANGE_URI = '%s'

NETWOR_SECERT = '%s'


def build_header(ip):
    md5 = hashlib.md5()
    md5.update('{0}:{1}'.format(NETWOR_SECERT, ip).encode('utf-8'))
    sign = md5.hexdigest()
    return {
        'X-Real-IP': ip,
        'x-sign': sign
    }
    
@app.route('/')
def index(version):
    return 'meta-service',200

@app.route('/<version>/meta-data/')
def get_meta_data(version):
    ip: str = request.headers.get('X-Real-IP')
    with requests.get('{0}/{1}/meta-data/'.format(MANGE_URI,
                                                  version), headers=build_header(ip)) as response:

        return response.text, response.status_code


@app.route('/<version>/meta-data/<name>')
def get_meta_data_value(version, name):
    ip: str = request.headers.get('X-Real-IP')
    with requests.get('{0}/{1}/meta-data/{2}'.format(MANGE_URI,
                                                     version, name), headers=build_header(ip)) as response:

        return response.text, response.status_code


@app.route('/<version>/user-data')
def get_user_data(version):
    ip: str = request.headers.get('X-Real-IP')
    with requests.get('{0}/{1}/user-data'.format(MANGE_URI,
                                                 version), headers=build_header(ip)) as response:
        return response.text, response.status_code, [("Content-Type", response.headers.get("Content-Type"))]


if __name__ == '__main__':
    app.run(host='0.0.0.0', port=9088)